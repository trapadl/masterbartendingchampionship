import{s as S,l as J,r as n,j as e,c as I,u as K,a as X,b as Z,d as ee,e as te}from"./main-COpenfq-.js";import{O as re,c as ae,s as A}from"./toast-yeIG7IQm.js";class se{async fetchLeaderboardData(){try{const{data:f,error:g}=await S.from("legacy_results").select(`
          id,
          legacy_competition_id,
          bartender_id,
          placement,
          points,
          status,
          competition_category,
          legacy_competitions (
            id,
            name,
            date,
            category
          )
        `).eq("status","approved");if(g)throw g;const{data:v,error:p}=await S.from("bartenders").select(`
          id, 
          full_name,
          rating,
          rating_rd,
          rating_volatility,
          ranking,
          speed_rating,
          speed_rd,
          speed_volatility,
          speed_ranking,
          traditional_rating,
          traditional_rd,
          traditional_volatility,
          traditional_ranking,
          flair_rating,
          flair_rd,
          flair_volatility,
          flair_ranking
        `).eq("is_approved",!0).not("is_archived","eq",!0);if(p)throw p;const a={legacy:new Set,speed:new Set,traditional:new Set,flair:new Set};return f.forEach(t=>{var x;if(!t.bartender_id)return;let l=t.competition_category||"legacy";!t.competition_category&&((x=t.legacy_competitions)!=null&&x.category)&&(l=t.legacy_competitions.category),a[l]?a[l].add(t.bartender_id):a.legacy.add(t.bartender_id)}),{legacy:v.filter(t=>a.legacy.has(t.id)&&t.rating!=null).sort((t,l)=>(l.rating||0)-(t.rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.rating,rating_rd:t.rating_rd,points:Math.round(t.rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),speed:v.filter(t=>a.speed.has(t.id)&&t.speed_rating!=null).sort((t,l)=>(l.speed_rating||0)-(t.speed_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.speed_rating,rating_rd:t.speed_rd,points:Math.round(t.speed_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),traditional:v.filter(t=>a.traditional.has(t.id)&&t.traditional_rating!=null).sort((t,l)=>(l.traditional_rating||0)-(t.traditional_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.traditional_rating,rating_rd:t.traditional_rd,points:Math.round(t.traditional_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),flair:v.filter(t=>a.flair.has(t.id)&&t.flair_rating!=null).sort((t,l)=>(l.flair_rating||0)-(t.flair_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.flair_rating,rating_rd:t.flair_rd,points:Math.round(t.flair_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'}))}}catch(f){return J(f),{legacy:[],traditional:[],flair:[],speed:[]}}}}const ie=new se,Y=({isOpen:c,onClose:f,title:g,children:v,maxWidth:p="max-w-xl"})=>{if(n.useEffect(()=>{const t=l=>{l.key==="Escape"&&f()};return c?(document.addEventListener("keydown",t),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[c,f]),!c)return null;const a=t=>{t.target===t.currentTarget&&f()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 transition-opacity duration-300 ease-in-out",onClick:a,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`bg-zinc-800 rounded-lg shadow-xl w-full ${p} max-h-[90vh] overflow-hidden flex flex-col`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-700 flex-shrink-0",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-white",children:g||"Modal"}),e.jsx("button",{type:"button",onClick:f,className:"text-gray-400 hover:text-white text-2xl leading-none font-bold focus:outline-none p-1","aria-label":"Close modal",children:"Ã—"})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-grow",children:v})]})})},H=I("CompetitionHistoryModalContent"),ne=({bartenderId:c,bartenderName:f})=>{const[g,v]=n.useState([]),[p,a]=n.useState(!0),[t,l]=n.useState(null);n.useEffect(()=>{(async()=>{if(!c){a(!1),l("Bartender ID is missing.");return}a(!0),l(null),H.debug(`Fetching history for bartender ID: ${c}`);try{const{data:r,error:m}=await S.from("legacy_results").select(`placement,
             post_competition_rating,
             pre_competition_rating,
             legacy_competition_id,
             legacy_competitions (
               id,
               name,
               date
             )`).eq("bartender_id",c).order("date",{ascending:!1,foreignTable:"legacy_competitions"});if(m)throw m;H.debug("Fetched competition history",{bartenderId:c,resultCount:r==null?void 0:r.length}),v(r||[])}catch(r){H.error("Error fetching competition history:",{bartenderId:c,error:r}),l(`Failed to load competition history: ${r.message}. Please try again.`)}finally{a(!1)}})()},[c]);const x=(b,r)=>b==null||r==null?"?":Math.round(r-b);return e.jsx("div",{className:"competition-history-content max-h-[70vh] overflow-y-auto pr-2",children:p?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx("div",{className:"animate-spin h-6 w-6 border-4 border-white rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-3 text-gray-300",children:"Loading history..."})]}):t?e.jsx("div",{className:"text-red-400 p-4 text-center bg-black/50 rounded border border-red-500",children:t}):g.length===0?e.jsxs("div",{className:"text-gray-400 p-6 text-center italic",children:["No competition history found for ",f,"."]}):e.jsxs("table",{className:"competition-history-table min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Competition"}),e.jsx("th",{className:"text-center",children:"Placement"}),e.jsx("th",{className:"text-center",children:"Rating Change"})]})}),e.jsx("tbody",{children:g.map((b,r)=>{var h,s,o;const m=x(b.pre_competition_rating,b.post_competition_rating),u=(h=b.legacy_competitions)!=null&&h.date?new Date(b.legacy_competitions.date).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"}):"Unknown Date",y=m==="?"?"text-gray-400":m>0?"text-white":"text-gray-400",k=(s=b.legacy_competitions)!=null&&s.id?`${b.legacy_competitions.id}-${r}`:r;return e.jsxs("tr",{className:"even:bg-zinc-800 odd:bg-gradient-to-b from-zinc-800 to-zinc-900",children:[e.jsx("td",{className:"text-sm text-gray-300 whitespace-nowrap",children:u}),e.jsx("td",{className:"text-sm text-white",children:((o=b.legacy_competitions)==null?void 0:o.name)||"Unknown Competition"}),e.jsx("td",{className:"text-sm text-center text-gray-300",children:b.placement||"N/A"}),e.jsx("td",{className:`text-sm text-center font-medium ${y}`,children:m>=0?`+${m}`:m})]},k)})})]})})},oe=e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[" ",e.jsx("circle",{cx:"12",cy:"7",r:"4"})," ",e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})," "]}),U=10,le=({data:c=[],type:f="legacy",filter:g="rating",currentPage:v=0,onPageChange:p,searchActive:a=!1})=>{const[t,l]=n.useState(!1),[x,b]=n.useState(null),r=N=>Math.round(N.rating||0),m="Rating",u=a?0:v*U,y=a?c.slice(0,Math.min(50,c.length)):c.slice(u,u+U),k=a?1:Math.ceil(c.length/U),h=v<k-1,s=v>0,o=a&&c.length>50,d=N=>{if(!N||!N.id){console.error("Invalid bartender data for history modal:",N);return}b(N),l(!0)},j=()=>{l(!1),b(null)},E=N=>{console.log("Open Profile Clicked:",N.name)},P=N=>N%2===0?"bg-zinc-850":"bg-zinc-800";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overflow-x-auto rounded-lg shadow",children:[" ",e.jsxs("table",{className:"leaderboard-table min-w-full divide-y divide-gray-700","data-type":f,"data-page":v,"data-filter":g,children:[e.jsx("thead",{className:"bg-zinc-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Rank"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Profile"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:m})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-700",children:[y.map((N,z)=>e.jsxs("tr",{className:`${P(z)} hover:bg-zinc-700`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:a?z+1:u+z+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"profile-pic h-10 w-10 bg-zinc-600 rounded-full flex items-center justify-center cursor-pointer border border-gray-500 hover:border-white transition-colors",onClick:()=>E(N),title:`View profile for ${N.name}`,children:oe})}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:e.jsxs("span",{className:"cursor-pointer hover:text-gray-300 transition-colors",onClick:()=>d(N),onKeyDown:B=>(B.key==="Enter"||B.key===" ")&&d(N),role:"button",tabIndex:0,title:`View competition history for ${N.name}`,children:[N.name||"Unnamed Bartender"," "]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-white font-medium",children:[r(N),N.rating_rd!=null&&N.rating_rd>100&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",title:`Rating Deviation: ${N.rating_rd.toFixed(1)} (Higher means less certainty)`,children:["Â±",Math.round(N.rating_rd)]})]})]},N.id||z)),!a&&(h||s)&&e.jsxs("tr",{className:"pagination-row bg-zinc-800",children:[" ",e.jsxs("td",{colSpan:"4",className:"text-center py-3 px-4 border-t border-gray-700",children:[" ",e.jsxs("div",{className:"pagination-controls flex justify-center gap-3",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"pagination-button",onClick:()=>p(0),children:" Top 10 "}),e.jsx("button",{className:"pagination-button",onClick:()=>p(v-1),children:" Previous 10 "})]}),h&&e.jsx("button",{className:"pagination-button",onClick:()=>p(v+1),children:" Next 10 "})]})]})]}),o&&e.jsx("tr",{className:"bg-zinc-800",children:e.jsx("td",{colSpan:"4",className:"text-center py-3 px-4 text-gray-400 border-t border-gray-700",children:"Showing top 50 results. Please refine your search to see more specific results."})})]})]}),(!Array.isArray(c)||c.length===0)&&e.jsx("div",{className:"text-center py-8 px-4 text-gray-400 italic",children:a?"No bartenders found matching your search.":"No ranked competitors found for this category yet."}),Array.isArray(c)&&c.length>0&&y.length===0&&!a&&e.jsx("div",{className:"text-center py-8 px-4 text-gray-400 italic",children:"No more results on this page."})]}),e.jsx(Y,{isOpen:t,onClose:j,title:`${(x==null?void 0:x.name)||"Bartender"}'s Competition History`,maxWidth:"max-w-4xl",children:x&&e.jsx(ne,{bartenderId:x.id,bartenderName:x.name})})]})},O=({id:c,title:f,type:g,data:v,page:p,filter:a,onPageChange:t,onFilterChange:l,showFilters:x=!1,showClaimButton:b=!1,hasPendingClaim:r=!1,comingSoon:m=!1,onClaimProfileClick:u,onSubmitResultClick:y})=>{const[k,h]=n.useState(""),s="px-4 py-2 rounded border transition-colors duration-200",o=`${s} bg-white text-black border-white hover:bg-zinc-200 hover:border-gray-200`,d=`${s} bg-transparent text-white border-gray-500 hover:bg-zinc-700`,j=`${s} bg-white text-black border-white`,E=k.trim()?v.filter(z=>z.name.toLowerCase().includes(k.toLowerCase())):v,P=z=>{h(z.target.value),p!==0&&t(g,0)},N=()=>{h("")};return e.jsxs("div",{id:c,className:`leaderboard-container ${m?"coming-soon":""} mb-12`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-white",children:f}),!m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"search-container mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:k,onChange:P,className:"w-1/4 p-2 pl-10 bg-zinc-700 text-white rounded border border-gray-600 focus:border-gray-500 focus:outline-none"}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),k&&e.jsx("button",{className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white",onClick:N,children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]}),k&&E.length===0?e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:['No results found for "',k,'"']}):k?e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["Found ",E.length," ",E.length===1?"result":"results"]}):null]}),e.jsxs("div",{className:"button-container flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[x&&e.jsx("div",{className:"filter-buttons flex gap-2",children:e.jsx("button",{className:a==="rating"?j:d,onClick:()=>l(g,"rating"),children:"Rating"})}),g==="legacy"&&e.jsxs("div",{className:"action-buttons flex gap-2",children:[b&&u&&(r?e.jsx("button",{className:`${o} bg-zinc-600 text-gray-400 border-gray-600 cursor-not-allowed opacity-70`,disabled:!0,children:"Claim Pending"}):e.jsx("button",{className:o,onClick:u,children:"Claim Profile"})),y&&e.jsx("button",{className:o,onClick:y,children:"Submit Result"})]})]})]}),e.jsx("div",{className:"leaderboard-content",children:e.jsx(le,{data:E,type:g,filter:a,currentPage:p,onPageChange:z=>t(g,z),searchActive:k.trim().length>0})})]})},V=I("BartenderSelect"),W=({value:c,onSelect:f,placeholder:g="Select a bartender",initialLabel:v="",excludeIds:p=[]})=>{const[a,t]=n.useState(v),[l,x]=n.useState(!1),[b,r]=n.useState([]),[m,u]=n.useState(!1),[y,k]=n.useState(null);n.useEffect(()=>{if(!a.trim()){r([]);return}const d=setTimeout(async()=>{u(!0);try{let j=S.from("bartenders").select("id, full_name, is_approved").ilike("full_name",`%${a}%`).is("is_archived",!1);p.length>0&&(j=j.not("id","in",`(${p.join(",")})`));const{data:E,error:P}=await j.limit(5);if(P)throw P;r(E||[])}catch(j){V.error("Failed to load bartenders:",j),k("Failed to load bartenders")}finally{u(!1)}},300);return()=>clearTimeout(d)},[a,p.join(",")]);const h=o=>{t(o.full_name),x(!1),f(o)},s=async()=>{try{const{data:{user:o}}=await S.auth.getUser();if(!o)throw new Error("Please sign in to add a new bartender");const{data:d,error:j}=await S.from("bartenders").insert({full_name:a.trim(),bar:"",rating:1500,rating_rd:350,rating_volatility:.06,is_profile_claimed:!1,is_approved:!1}).select().single();if(j)throw j;V.info("Created new bartender:",{id:d.id,name:d.full_name}),alert("New bartender created! Note: Bartenders need to be approved by an administrator before appearing on leaderboards."),t(d.full_name),x(!1),f(d)}catch(o){V.error("Error adding new bartender:",o),k(o.message)}};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a,onChange:o=>{t(o.target.value),x(!0)},onClick:()=>x(!0),placeholder:g,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),l&&(a.trim()||m||y)&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg",children:[m&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),y&&e.jsx("div",{className:"p-2 text-red-400",children:y}),!m&&!y&&b.length>0&&e.jsxs("div",{children:[b.map(o=>e.jsx("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>h(o),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:o.full_name}),o.is_approved===!1&&e.jsx("span",{className:"text-xs text-yellow-400 px-2 py-1 bg-zinc-800 rounded",children:"Pending"})]})},o.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),a.trim()&&e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:s,children:[e.jsxs("span",{children:['+ Add "',a.trim(),'" as new bartender']}),e.jsx("span",{className:"text-gray-400",children:"â†’"})]}),!m&&!y&&a.trim()&&b.length===0&&!y&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"No matching bartenders found"})]})]})},$=I("ClaimForm"),ce=({onSuccess:c,onError:f})=>{const[g,v]=n.useState(null),[p,a]=n.useState(!1),[t,l]=n.useState(null),[x,b]=n.useState(!1),[r,m]=n.useState(null);n.useEffect(()=>{u()},[]);const u=async()=>{try{a(!0);const{data:{user:h}}=await S.auth.getUser();if(!h)return;const{data:s,error:o}=await S.from("submissions").select("id, status, content").eq("user_id",h.id).eq("status","pending").like("content",'%"type":"profile_claim"%').maybeSingle();if(o&&o.code!=="PGRST116")throw o;if(s){$.info("Found existing pending claim",{submissionId:s.id}),l(s);return}const{data:d,error:j}=await S.from("bartenders").select("id, is_profile_claimed").eq("user_id",h.id).single();if(j&&j.code!=="PGRST116")throw j;d!=null&&d.is_profile_claimed&&($.info("User already has a claimed profile",{bartenderId:d.id}),c==null||c({alreadyClaimed:!0}))}catch(h){$.error("Error checking existing claim:",h),m(h.message),f==null||f(h.message)}finally{a(!1)}},y=async h=>{h.preventDefault(),a(!0),m(null),b(!1);try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("Authentication required");if(!g)throw new Error("Please select a bartender profile");const{data:o,error:d}=await S.from("bartenders").select("is_profile_claimed, users_attempting_to_claim").eq("id",g.id).single();if(d)throw d;if(o!=null&&o.is_profile_claimed)throw new Error("This profile has already been claimed");const j=o.users_attempting_to_claim||[];if(!j.includes(s.id)){const{error:P}=await S.from("bartenders").update({users_attempting_to_claim:[...j,s.id]}).eq("id",g.id);if(P)throw P}const{error:E}=await S.from("submissions").insert({user_id:s.id,content:JSON.stringify({type:"profile_claim",bartender_id:g.id,bartender_name:g.full_name,submitted_at:new Date().toISOString()}),status:"pending"});if(E)throw E;b(!0),$.info("Profile claim submitted successfully",{userId:s.id,bartenderId:g.id}),setTimeout(()=>{c==null||c()},2e3)}catch(s){m(s.message),f==null||f(s.message),$.error("Error submitting profile claim:",s)}finally{a(!1)}},k=async()=>{if(t){a(!0);try{const{data:{user:h}}=await S.auth.getUser();if(!h)throw new Error("Authentication required");let s=null;try{s=JSON.parse(t.content).bartender_id}catch(d){$.error("Error parsing claim content:",d)}if(s){const{data:d}=await S.from("bartenders").select("users_attempting_to_claim").eq("id",s).single();if(d){const j=(d.users_attempting_to_claim||[]).filter(E=>E!==h.id);await S.from("bartenders").update({users_attempting_to_claim:j}).eq("id",s)}}const{error:o}=await S.from("submissions").update({status:"cancelled"}).eq("id",t.id);if(o)throw o;l(null),c==null||c({cancelled:!0}),$.info("Claim cancelled successfully",{submissionId:t.id})}catch(h){m(h.message),f==null||f(h.message),$.error("Error cancelling claim:",h)}finally{a(!1)}}};return t?e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl text-white mb-4",children:"Pending Profile Claim"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Your profile claim is currently under review by an administrator."}),e.jsx("button",{onClick:k,disabled:p,className:"w-full py-2 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":"Cancel Claim"})]}):e.jsxs("form",{onSubmit:y,className:"p-6",method:"POST",children:[e.jsx("h3",{className:"text-xl text-white mb-6",children:"Claim Your Profile"}),r&&e.jsx("div",{className:"error-message mb-4 p-3 bg-red-500/20 border border-red-500 rounded text-red-200",children:r}),x&&e.jsx("div",{className:"success-message mb-4 p-3 bg-green-500/20 border border-green-500 rounded text-green-200",children:"Profile claim submitted successfully! Your claim will be reviewed by an administrator."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white mb-2",children:"Select Your Profile"}),e.jsx(W,{onSelect:v,placeholder:"Search for your profile",unclaimedOnly:!0})]}),e.jsx("button",{type:"submit",disabled:p||!g||x,className:"w-full py-3 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Submitting...":"Submit Claim"})]})},de=({onSelect:c,placeholder:f="Search for competition"})=>{const[g,v]=n.useState(""),[p,a]=n.useState(!1),[t,l]=n.useState([]),[x,b]=n.useState(!1),[r,m]=n.useState(null);n.useEffect(()=>{if(!g.trim()){l([]);return}const k=setTimeout(async()=>{b(!0);try{const{data:h,error:s}=await S.from("legacy_competitions").select("id, name, date, venue").ilike("name",`%${g}%`).order("date",{ascending:!1}).limit(5);if(s)throw s;l(h||[])}catch(h){console.error("Error fetching competitions:",h),m("Failed to load competitions")}finally{b(!1)}},300);return()=>clearTimeout(k)},[g]);const u=()=>{c({name:g.trim(),isNew:!0}),v(g.trim()),a(!1)};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:g,onChange:y=>{v(y.target.value),a(!0)},onClick:()=>a(!0),placeholder:f,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),p&&g.trim()&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg max-h-60 overflow-y-auto",children:[x&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),r&&e.jsx("div",{className:"p-2 text-red-400",children:r}),!x&&!r&&t.length>0&&e.jsxs("div",{children:[t.map(y=>e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>{c(y),v(y.name),a(!1)},children:[e.jsx("div",{children:y.name}),e.jsxs("div",{className:"text-gray-400 text-sm",children:[new Date(y.date).toLocaleDateString()," - ",y.venue]}),e.jsx("hr",{className:"border-t border-gray-700 mt-2"})]},y.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:u,children:[e.jsxs("span",{children:['+ Add "',g.trim(),'" as new competition']}),e.jsx("span",{className:"text-gray-400",children:"â†’"})]})]})]})},G=I("VenueSelect"),me=({value:c,onSelect:f,placeholder:g="Select a venue",initialLabel:v=""})=>{const[p,a]=n.useState(v),[t,l]=n.useState(!1),[x,b]=n.useState([]),[r,m]=n.useState(!1),[u,y]=n.useState(null);n.useEffect(()=>{if(!p.trim()){b([]);return}const o=setTimeout(async()=>{m(!0);try{const{data:d,error:j}=await S.from("venues").select("id, name, city, country").ilike("name",`%${p}%`).is("is_archived",!1).order("name").limit(5);if(j)throw j;b(d||[])}catch(d){G.error("Failed to load venues:",d),y("Failed to load venues")}finally{m(!1)}},300);return()=>clearTimeout(o)},[p]);const k=s=>{a(s.name),l(!1),f(s)},h=async()=>{try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("Please sign in to add a new venue");const{data:o,error:d}=await S.from("venues").insert({name:p.trim(),created_by:s.id}).select().single();if(d)throw d;G.info("Created new venue:",{id:o.id,name:o.name}),a(o.name),l(!1),f(o)}catch(s){G.error("Error adding new venue:",s),y(s.message)}};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p,onChange:s=>{a(s.target.value),l(!0)},onClick:()=>l(!0),placeholder:g,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),t&&(p.trim()||r||u)&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg",children:[r&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),u&&e.jsx("div",{className:"p-2 text-red-400",children:u}),!r&&!u&&x.length>0&&e.jsxs("div",{children:[x.map(s=>e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>k(s),children:[e.jsx("div",{children:s.name}),s.city&&s.country&&e.jsxs("div",{className:"text-gray-400 text-sm",children:[s.city,", ",s.country]})]},s.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),p.trim()&&e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:h,children:[e.jsxs("span",{children:['+ Add "',p.trim(),'" as new venue']}),e.jsx("span",{className:"text-gray-400",children:"â†’"})]}),!r&&!u&&p.trim()&&x.length===0&&!u&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"No matching venues found"})]})]})},ue=[{id:"state final",label:"State Final"},{id:"national final",label:"National Final"},{id:"global final",label:"Global Final"}],ge=({onSuccess:c,onError:f})=>{const[g,v]=n.useState(!1),[p,a]=n.useState(""),[t,l]=n.useState([{id:"",position:""}]),[x,b]=n.useState(!1),[r,m]=n.useState({date:"",venue_id:"",venue_name:"",organizer_id:"",organizer_name:"",source_url:"",category:"legacy",country:"",round:"state final"}),[u,y]=n.useState(null),[k,h]=n.useState(!1),s=()=>{const{organizer_name:i,date:_,round:M,country:L}=r,w=(u==null?void 0:u.name)||"";if(!_||!i||!w||!M)return null;const C=new Date(_).getFullYear();return`${i} ${w} ${C} ${M} ${L||""}`.trim()},o=i=>{y(i),b(!(i!=null&&i.id)),i!=null&&i.id&&m(_=>({..._,date:i.date,venue_id:i.venue_id,venue_name:i.venue,organizer_id:i.organizer,category:i.category||"legacy",country:i.country||""}))},d=async i=>{try{const{data:_}=await S.from("organisers").select("organisation_name").eq("id",i.id).single();m(M=>({...M,organizer_id:i.id,organizer_name:(_==null?void 0:_.organisation_name)||""}))}catch(_){console.error("Error fetching organizer details:",_),a("Error fetching organizer details")}},j=i=>{m(_=>({..._,venue_id:i.id,venue_name:i.name}))},E=i=>({1:25,2:15,3:15,4:12,5:10,6:8,7:6,8:4,9:2,10:1})[i]||0,P=async i=>{i.preventDefault(),v(!0),a(""),h(!1);try{const{data:{user:_},error:M}=await S.auth.getUser();if(M)throw new Error("Authentication error");if(!_)throw new Error("Please sign in to submit results");if(x){if(!r.date)throw new Error("Date is required");if(!r.organizer_id)throw new Error("Organizer is required");if(!r.venue_id)throw new Error("Venue is required");if(!(u!=null&&u.name))throw new Error("Competition name is required");if(!r.round)throw new Error("Competition round is required")}let L;if(u!=null&&u.id)L=u.id;else{const C=s();if(!C)throw new Error("Unable to generate competition name - missing required fields");const{data:T,error:R}=await S.from("legacy_competitions").insert({name:C,date:r.date,venue:r.venue_name,venue_id:r.venue_id,organizer:r.organizer_id,category:r.category,country:r.country||null,created_by:_.id,status:"pending"}).select().single();if(R)throw R;L=T.id}const w=t.filter(C=>C.id&&C.position);if(w.length===0)throw new Error("At least one competitor with position is required");for(const C of w){const{error:T}=await S.from("legacy_results").insert({legacy_competition_id:L,bartender_id:C.id,placement:parseInt(C.position,10),points:E(parseInt(C.position,10)),status:"pending",created_by:_.id,competition_category:r.category});if(T)throw T}if(r.source_url){const{error:C}=await S.from("sources").insert({legacy_competition_id:L,url:r.source_url,created_by:_.id});if(C)throw C}h(!0),setTimeout(()=>{N(),c==null||c()},2e3)}catch(_){console.error("Submission error:",_),a(_.message),f==null||f(_.message)}finally{v(!1)}},N=()=>{m({date:"",venue_id:"",venue_name:"",organizer_id:"",organizer_name:"",source_url:"",category:"legacy",country:"",round:"state final"}),y(null),l([{id:"",position:""}]),b(!1),h(!1)},z=()=>{l(i=>[...i,{id:"",position:""}])},B=i=>{l(_=>_.filter((M,L)=>L!==i))};return e.jsxs("div",{className:"p-6 bg-zinc-800 rounded-lg",children:[e.jsx("h3",{className:"text-xl text-white mb-6",children:"Submit Competition Result"}),p&&e.jsx("div",{className:"error-message mb-4 p-3 bg-red-500/20 border border-red-500 rounded text-red-200",children:p}),k&&e.jsx("div",{className:"success-message mb-4 p-3 bg-green-500/20 border border-green-500 rounded text-green-200",children:"Competition result submitted successfully! Your submission will be reviewed by an administrator."}),e.jsxs("form",{onSubmit:P,className:"space-y-6",method:"POST",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Competition *"}),e.jsx(de,{onSelect:o,placeholder:"Search or add competition"})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Organizer *"}),e.jsx(re,{onSelect:d,placeholder:"Select organizer"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Venue *"}),e.jsx(me,{onSelect:j,placeholder:"Select or add venue"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Round *"}),e.jsx("select",{value:r.round,onChange:i=>m({...r,round:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,children:ue.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Category *"}),e.jsxs("select",{value:r.category,onChange:i=>m({...r,category:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,children:[e.jsx("option",{value:"legacy",children:"Legacy Competition"}),e.jsx("option",{value:"speed",children:"Speed"}),e.jsx("option",{value:"flair",children:"Flair"}),e.jsx("option",{value:"traditional",children:"Traditional"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Country"}),e.jsxs("select",{value:r.country,onChange:i=>m({...r,country:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",children:[e.jsx("option",{value:"",children:"Select country"}),ae.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Date *"}),e.jsx("input",{type:"date",value:r.date,onChange:i=>m({...r,date:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Source URL *"}),e.jsx("input",{type:"url",value:r.source_url,onChange:i=>m({...r,source_url:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,placeholder:"Link to competition results"})]}),e.jsxs("div",{className:"competitors-section mt-8",children:[e.jsx("h3",{className:"text-lg text-white mb-4",children:"Competitors *"}),t.map((i,_)=>e.jsxs("div",{className:"competitor-entry mb-4 p-4 bg-zinc-700 rounded",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-2",children:"Competitor Name *"}),e.jsx(W,{onSelect:M=>{const L=[...t];L[_].id=M.id,l(L)},placeholder:"Search for competitor"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-2",children:"Position *"}),e.jsx("input",{type:"number",value:i.position,onChange:M=>{const L=[...t];L[_].position=M.target.value,l(L)},className:"w-full p-2 bg-zinc-600 text-white rounded border border-gray-500",required:!0,min:"1"})]}),_>0&&e.jsx("button",{type:"button",onClick:()=>B(_),className:"text-red-400 hover:text-red-300 px-4 py-2 border border-red-500 rounded hover:bg-red-500/20 transition-colors",children:"Remove Competitor"})]},_)),e.jsx("button",{type:"button",onClick:z,className:"w-full p-2 border border-gray-400 text-gray-300 rounded hover:bg-zinc-700 transition-colors",children:"Add Competitor"})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full p-3 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Submitting...":"Submit Result"})]})]})},F=ee("HomePage"),fe=()=>{var L;const[c,f]=n.useState({legacy:[],traditional:[],flair:[],speed:[]}),[g,v]=n.useState(!0),[p,a]=n.useState(null),{user:t,isAuthenticated:l,profile:x,loading:b}=K(),[r,m]=n.useState(!1),[u,y]=n.useState({legacy:{page:0,filter:"rating"},speed:{page:0,filter:"rating"},traditional:{page:0,filter:"rating"},flair:{page:0,filter:"rating"}}),[k,h]=n.useState(!1),[s,o]=n.useState(!1),d=X(),j=Z(),E=(L=d.state)==null?void 0:L.scrollTo;n.useEffect(()=>{(async()=>{if(!l||!t){m(!1);return}try{const{data:C,error:T}=await te.from("submissions").select("id, status").eq("user_id",t.id).eq("status","pending").like("content",'%"type":"profile_claim"%').maybeSingle();if(T)throw T;m(!!C),F.debug("Pending claim check result:",{hasPendingClaim:!!C})}catch(C){F.error("Error checking pending claims:",C)}})()},[l,t]);const P=n.useCallback(async()=>{v(!0),a(null),F.info("Fetching leaderboard data...");try{const w=await ie.fetchLeaderboardData();f({legacy:(w==null?void 0:w.legacy)||[],traditional:(w==null?void 0:w.traditional)||[],flair:(w==null?void 0:w.flair)||[],speed:(w==null?void 0:w.speed)||[]}),F.info("Leaderboard data fetched successfully")}catch(w){F.error("Error fetching leaderboard data:",w),a("Failed to load leaderboard data. Please try again later."),f({legacy:[],traditional:[],flair:[],speed:[]})}finally{v(!1)}},[]);n.useEffect(()=>{P()},[P]),n.useEffect(()=>{if(E){F.debug(`Scrolling to section: ${E}`);const w=document.getElementById(`${E}-section`),C=document.querySelector(".column-right");if(w&&C){const T=w.offsetTop,R=parseFloat(getComputedStyle(C).paddingTop||"0"),q=T-R;F.debug(`Target offsetTop: ${T}, Container padding: ${R}, Effective scroll: ${q}`);const D=setTimeout(()=>{C.scrollTo({top:q,behavior:"smooth"}),j(d.pathname,{replace:!0,state:{...d.state,scrollTo:null}})},150);return()=>clearTimeout(D)}else F.warn(`Scroll target #${E}-section or .column-right not found`),j(d.pathname,{replace:!0,state:{...d.state,scrollTo:null}})}},[E,d.pathname,d.state,j]);const N=(w,C)=>{y(q=>({...q,[w]:{...q[w],page:C}}));const T=document.getElementById(`${w}-section`),R=document.querySelector(".column-right");if(T&&R){const q=T.offsetTop,D=parseFloat(getComputedStyle(R).paddingTop||"0"),Q=q-D;R.scrollTo({top:Q,behavior:"smooth"})}},z=(w,C)=>{y(T=>({...T,[w]:{...T[w],filter:C,page:0}}))},B=()=>{if(!l){A("Please sign in or create an account to claim a profile."),j("/enter",{state:{from:d}});return}h(!0),F.info("Claim Profile modal opened")},i=()=>{if(!l){A("Please sign in or create an account to submit results."),j("/enter",{state:{from:d}});return}o(!0),F.info("Submit Result modal opened")},M=!(l&&(x==null?void 0:x.is_profile_claimed)===!0)&&!r;return g||b?e.jsxs("div",{className:"flex justify-center items-center h-screen col-span-2",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-white rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-4 text-gray-300",children:"Loading Leaderboards..."})]}):p?e.jsx("div",{className:"text-center p-10 text-red-400 col-span-2",children:p}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"column-left hidden md:flex",children:[" ",e.jsxs("div",{className:"column-left-content text-white p-8",children:[" ",e.jsx("div",{style:{height:"calc(100vh * 4 / 13)",minHeight:"200px",flexShrink:0}}),l&&x?e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Welcome, ",x.full_name||"Competitor","!"]}):e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"PROFESSIONAL BARTENDING. A NEW GLOBAL SPORT."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"Our goal is to transform one of the worlds oldest professions into a thrilling, worldwide competition by uniting bartenders, bars, and brands under one transparent ranking system."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"These leaderboards rank bartenders with registered competition results. Legacy competitions are events held by brand organisers - the ones most bartenders are familiar with. MBC Speed, Traditional and Flair and MBC sanctioned events that adhere to guidelines of fairness, transparency and integrity."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To add yourself to the leaderboard, click 'submit result'."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To find out more about our pillars and goals, click the about section of our site menu."}),e.jsxs("p",{className:"text-gray-400 text-sm mt-8",children:["This service is created and maintained by passionate bartenders out of ",e.jsx("a",{href:"http://www.trapadl.com",className:"text-white hover:text-gray-300",target:"_blank",rel:"noopener noreferrer",children:"trap. cocktail bar"})," in Adelaide, Australia. It's constantly undergoing improvements. Feedback, bug reports, or contribution inquiries are welcome via ",e.jsx("a",{href:"mailto:cocktails+mbc@trapadl.com",className:"text-white hover:text-gray-300",children:"cocktails+mbc@trapadl.com"}),"."]})]})]}),e.jsxs("div",{className:"column-right w-full md:w-1/2",children:[" ",e.jsxs("div",{className:"column-right-content space-y-12 p-4 md:p-8 ",children:[" ",e.jsx(O,{id:"legacy-section",title:"Legacy Leaderboard",type:"legacy",data:c.legacy,page:u.legacy.page,filter:u.legacy.filter,onPageChange:N,onFilterChange:z,showFilters:!1,showClaimButton:M,hasPendingClaim:r,onClaimProfileClick:B,onSubmitResultClick:i}),e.jsx(O,{id:"speed-section",title:"MBC Speed Leaderboard",type:"speed",data:c.speed,page:u.speed.page,filter:u.speed.filter,onPageChange:N,onFilterChange:z}),e.jsx(O,{id:"traditional-section",title:"MBC Traditional Leaderboard",type:"traditional",data:c.traditional,page:u.traditional.page,filter:u.traditional.filter,onPageChange:N,onFilterChange:z,comingSoon:!0}),e.jsx(O,{id:"flair-section",title:"MBC Flair Leaderboard",type:"flair",data:c.flair,page:u.flair.page,filter:u.flair.filter,onPageChange:N,onFilterChange:z,comingSoon:!0})]})]}),e.jsx(Y,{isOpen:k,onClose:()=>h(!1),title:"Claim Your Profile",children:e.jsx(ce,{onSuccess:()=>{F.info("Claim success callback triggered."),h(!1),m(!0),P()},onError:w=>F.error("Claim form error:",w)})}),e.jsx(Y,{isOpen:s,onClose:()=>o(!1),title:"Submit Competition Result",maxWidth:"max-w-2xl",children:e.jsx(ge,{onSuccess:()=>{F.info("Result success callback triggered."),o(!1),A("Result submitted for admin review!")},onError:w=>F.error("Result form error:",w)})})]})};export{fe as default};
