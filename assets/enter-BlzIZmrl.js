import{s as d,g as m,l as y,d as b,i as S,b as E}from"./countdown-DXygMo4P.js";async function w(){const t=document.querySelectorAll(".auth-tab"),e=document.querySelectorAll(".auth-form"),o=await b.getCurrentUser();if(o){g(o);return}if(t.length>0&&e.length>0){t.forEach(n=>{n.addEventListener("click",()=>{var i;const r=n.dataset.form;t.forEach(a=>a.classList.remove("active")),e.forEach(a=>a.classList.remove("active")),n.classList.add("active"),(i=document.getElementById(`${r}-form`))==null||i.classList.add("active")})});const c=document.getElementById("signin-form"),s=document.getElementById("signup-form");if(c&&c.addEventListener("submit",q),s){s.addEventListener("submit",L);const n=s.querySelector('select[name="role"]'),r=s.querySelector(".bartender-fields"),i=s.querySelector(".organiser-fields");n&&r&&i&&n.addEventListener("change",a=>{r.style.display=a.target.value==="bartender"?"block":"none",i.style.display=a.target.value==="organiser"?"block":"none"})}}}async function q(t){t.preventDefault();const e=t.target,o=e.querySelector('input[type="email"]').value,c=e.querySelector('input[type="password"]').value,s=v(e),n=h(e);s.style.display="none",n.style.display="none";try{const{data:r,error:i}=await d.auth.signInWithPassword({email:o,password:c});if(i)throw i;if(r.user){n.textContent="Login successful! Redirecting...",n.style.display="block",g(r.user);const a=m();setTimeout(()=>window.location.href=a,1500)}}catch(r){y(r),s.textContent=r.message||"Error signing in",s.style.display="block"}}async function L(t){t.preventDefault();const e=t.target,o=e.querySelector('input[name="fullName"]').value,c=e.querySelector('input[name="email"]').value,s=e.querySelector('input[name="password"]').value,n=e.querySelector('select[name="role"]').value,r=n==="bartender"?e.querySelector('input[name="bar"]').value:null,i=n==="organiser"?e.querySelector('input[name="brand"]').value:null,a=v(e),u=h(e);a.style.display="none",u.style.display="none";try{const{data:l,error:f}=await d.auth.signUp({email:c,password:s,options:{data:{full_name:o,role:n,bar:r,brand:i}}});if(f)throw f;if(l.user){window.fbq&&fbq("track","CompleteRegistration",{content_name:"New MBC Signup",content_category:n}),u.textContent="Account created successfully! Please check your email for verification.",u.style.display="block";const p=m();setTimeout(()=>window.location.href=p,3e3)}}catch(l){y(l),a.textContent=l.message||"Error creating account",a.style.display="block"}}function g(t){const e=document.querySelector(".auth-container");e&&(e.innerHTML=`
      <div class="profile-summary">
        <h2>Welcome, ${t.user_metadata.full_name||"User"}</h2>
        <button onclick="handleSignOut()" class="submit-button">Sign Out</button>
      </div>
    `)}function v(t){let e=t.querySelector(".error-message");return e||(e=document.createElement("div"),e.className="error-message",t.insertBefore(e,t.firstChild)),e}function h(t){let e=t.querySelector(".success-message");return e||(e=document.createElement("div"),e.className="success-message",t.insertBefore(e,t.firstChild)),e}window.handleSignOut=async function(){try{const{error:t}=await d.auth.signOut();if(t)throw t;const e=m();window.location.href=e+"enter"}catch(t){y(t),alert("Error signing out. Please try again.")}};document.addEventListener("DOMContentLoaded",()=>{S(),E(),w()});function C(){const t=document.querySelectorAll(".auth-tab"),e=document.querySelectorAll(".auth-form"),o=document.querySelector('select[name="role"]'),c=document.querySelector(".bartender-fields"),s=document.querySelector(".organiser-fields");t.forEach(n=>{n.addEventListener("click",()=>{t.forEach(r=>r.classList.remove("active")),e.forEach(r=>r.classList.remove("active")),n.classList.add("active"),document.getElementById(`${n.dataset.form}-form`).classList.add("active")})}),o==null||o.addEventListener("change",n=>{n.target.value==="bartender"?(c.style.display="block",s.style.display="none"):(c.style.display="none",s.style.display="block")})}C();
