import{s as f,g as y,l as g,d as q,i as w,b as L}from"./countdown-DXygMo4P.js";import{s as v}from"./security-C8qXad-2.js";async function C(){const e=document.querySelectorAll(".auth-tab"),t=document.querySelectorAll(".auth-form"),a=await q.getCurrentUser();if(a){h(a);return}if(e.length>0&&t.length>0){e.forEach(s=>{s.addEventListener("click",()=>{var n;const r=s.dataset.form;e.forEach(i=>i.classList.remove("active")),t.forEach(i=>i.classList.remove("active")),s.classList.add("active"),(n=document.getElementById(`${r}-form`))==null||n.classList.add("active")})});const c=document.getElementById("signin-form"),o=document.getElementById("signup-form");if(c&&c.addEventListener("submit",v(k),!0),o){o.addEventListener("submit",v(U),!0);const s=o.querySelector('select[name="role"]'),r=o.querySelector(".bartender-fields"),n=o.querySelector(".organiser-fields");s&&r&&n&&s.addEventListener("change",i=>{r.style.display=i.target.value==="bartender"?"block":"none",n.style.display=i.target.value==="organiser"?"block":"none"})}}}async function k(e){e.preventDefault();const t=e.target,a=t.querySelector('button[type="submit"]');d(a,!0);const c=t.querySelector('input[type="email"]').value,o=t.querySelector('input[type="password"]').value,s=S(t),r=b(t);s.style.display="none",r.style.display="none";try{const{data:n,error:i}=await f.auth.signInWithPassword({email:c,password:o});if(i)throw i;if(n.user){r.textContent="Login successful! Redirecting...",r.style.display="block",h(n.user);const l=y();setTimeout(()=>window.location.href=l,1500)}}catch(n){g(n),s.textContent=n.message||"Error signing in",s.style.display="block",d(a,!1)}}async function U(e){e.preventDefault();const t=e.target,a=t.querySelector('button[type="submit"]');d(a,!0);const c=t.querySelector('input[name="fullName"]').value,o=t.querySelector('input[name="email"]').value,s=t.querySelector('input[name="password"]').value,r=t.querySelector('select[name="role"]').value,n=r==="bartender"?t.querySelector('input[name="bar"]').value:null,i=r==="organiser"?t.querySelector('input[name="brand"]').value:null,l=S(t),m=b(t);l.style.display="none",m.style.display="none";try{const{data:u,error:p}=await f.auth.signUp({email:o,password:s,options:{data:{full_name:c,role:r,bar:n,brand:i}}});if(p)throw p;if(u.user){window.fbq&&fbq("track","CompleteRegistration",{content_name:"New MBC Signup",content_category:r}),m.textContent="Account created successfully! Please check your email for verification.",m.style.display="block";const E=y();setTimeout(()=>window.location.href=E,3e3)}}catch(u){g(u),l.textContent=u.message||"Error creating account",l.style.display="block",d(a,!1)}}function h(e){const t=document.querySelector(".auth-container");t&&(t.innerHTML=`
      <div class="profile-summary">
        <h2>Welcome, ${e.user_metadata.full_name||"User"}</h2>
        <button onclick="handleSignOut()" class="submit-button">Sign Out</button>
      </div>
    `)}function S(e){let t=e.querySelector(".error-message");return t||(t=document.createElement("div"),t.className="error-message",e.insertBefore(t,e.firstChild)),t}function b(e){let t=e.querySelector(".success-message");return t||(t=document.createElement("div"),t.className="success-message",e.insertBefore(t,e.firstChild)),t}function d(e,t){e&&(t?(e.dataset.originalText=e.textContent,e.disabled=!0,e.classList.add("loading"),e.textContent="Loading..."):(e.textContent=e.dataset.originalText||(e.closest("#signin-form")?"Sign In":"Sign Up"),e.disabled=!1,e.classList.remove("loading")))}window.handleSignOut=async function(){try{const{error:e}=await f.auth.signOut();if(e)throw e;const t=y();safeRedirect(t+"enter")}catch(e){g(e),alert("Error signing out. Please try again.")}};document.addEventListener("DOMContentLoaded",()=>{w(),L(),C()});function B(){const e=document.querySelectorAll(".auth-tab"),t=document.querySelectorAll(".auth-form"),a=document.querySelector('select[name="role"]'),c=document.querySelector(".bartender-fields"),o=document.querySelector(".organiser-fields");e.forEach(s=>{s.addEventListener("click",()=>{e.forEach(r=>r.classList.remove("active")),t.forEach(r=>r.classList.remove("active")),s.classList.add("active"),document.getElementById(`${s.dataset.form}-form`).classList.add("active")})}),a==null||a.addEventListener("change",s=>{s.target.value==="bartender"?(c.style.display="block",o.style.display="none"):(c.style.display="none",o.style.display="block")})}B();
