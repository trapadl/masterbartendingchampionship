import{r as c,j as e,R as C,e as f,d as E}from"./main-COpenfq-.js";const i=E("SchedulePage"),k=()=>{const[o,y]=c.useState([]),[x,j]=c.useState([]),[N,m]=c.useState(!0),[p,h]=c.useState(null),[d,b]=c.useState(null);c.useEffect(()=>{(async()=>{m(!0),h(null),i.info("Fetching competition schedule data...");try{const s=new Date().toISOString().split("T")[0],{data:a,error:n}=await f.from("legacy_competitions").select("id, name, date, venue, category, status, more_info_link").gte("date",s).order("date",{ascending:!0});if(n)throw i.error("Error fetching upcoming competitions:",n),new Error(`Failed to fetch upcoming competitions: ${n.message}`);y(a||[]),i.debug(`Fetched ${(a==null?void 0:a.length)||0} upcoming competitions.`);const{data:l,error:r}=await f.from("legacy_competitions").select(`
            id, name, date, venue, category, status,
            legacy_results (
              placement,
              post_competition_rating,
              pre_competition_rating,
              bartender:bartenders ( full_name )
            )
          `).eq("status","approved").lt("date",s).order("date",{ascending:!1});if(r)throw i.error("Error fetching past competitions:",r),new Error(`Failed to fetch past competitions: ${r.message}`);j(l||[]),i.debug(`Fetched ${(l==null?void 0:l.length)||0} past competitions.`)}catch(s){i.error("Error in fetchCompetitions:",s),h(s.message)}finally{m(!1),i.info("Finished fetching competition schedule data.")}})()},[]);const v=t=>{b(d===t?null:t)},g=t=>{let s="category-badge",a=t||"Legacy";switch(t==null?void 0:t.toLowerCase()){case"speed":s+=" category-speed bg-red-500 text-white",a="Speed";break;case"flair":s+=" category-flair bg-green-500 text-black",a="Flair";break;case"traditional":case"legacy":s+=" category-traditional bg-blue-500 text-white",a="Traditional";break;default:s+=" bg-zinc-500 text-white";break}return e.jsx("span",{className:`${s} inline-block px-2 py-1 rounded text-xs font-medium`,children:a})};return N?e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-4 text-gray-300",children:"Loading Schedule..."})]}):p?e.jsxs("div",{className:"text-center p-10 text-red-400",children:["Error loading schedule: ",p]}):e.jsxs("div",{className:"content-section max-w-6xl mx-auto px-4 sm:px-8 py-8 text-white",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Competition Schedule"}),e.jsxs("div",{className:"schedule-table-wrapper mt-4 bg-zinc-800 rounded-lg overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-semibold p-4 border-b border-gray-700",children:"Upcoming Events"}),o.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"schedule-table min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-700",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"More Info"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-750",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:g(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.venue}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.more_info_link?e.jsx("a",{href:t.more_info_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 hover:underline",children:"See More"}):"N/A"})]},t.id))})]})}):e.jsx("p",{className:"p-4 text-gray-400",children:"No upcoming events scheduled yet."})]}),e.jsx("h2",{className:"text-2xl font-bold mt-12 mb-6",children:"Past Competitions"}),e.jsx("div",{className:"schedule-table-wrapper mt-4 bg-zinc-800 rounded-lg overflow-hidden",children:x.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"schedule-table min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-700",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Results"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:x.map(t=>e.jsxs(C.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-zinc-750",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:g(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.venue}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>v(t.id),className:"text-blue-400 hover:text-blue-300 text-xl","aria-expanded":d===t.id,children:d===t.id?"▲":"▼"})})]}),d===t.id&&e.jsx("tr",{className:"bg-zinc-750",children:e.jsx("td",{colSpan:"5",className:"p-0",children:e.jsx("div",{className:"p-4",children:t.legacy_results&&t.legacy_results.length>0?e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Placement"}),e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Bartender"}),e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Rating After"}),e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Change"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-600",children:t.legacy_results.sort((s,a)=>s.placement-a.placement).map((s,a)=>{var u;const n=s.post_competition_rating??"?",l=s.pre_competition_rating??n,r=n!=="?"&&l!=="?"?Math.round(n-l):"?",w=r!=="?"&&r>=0?"+":"",_=r!=="?"?r>0?"text-green-400":r<0?"text-red-400":"text-gray-400":"text-gray-400";return e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-3",children:s.placement}),e.jsx("td",{className:"py-2 px-3",children:((u=s.bartender)==null?void 0:u.full_name)||"Unknown"}),e.jsx("td",{className:"py-2 px-3",children:n!=="?"?Math.round(n):"?"}),e.jsxs("td",{className:`py-2 px-3 ${_}`,children:[w,r]})]},a)})})]}):e.jsx("p",{className:"text-gray-400 italic",children:"No results available for this competition."})})})})]},t.id))})]})}):e.jsx("p",{className:"p-4 text-gray-400",children:"No past competition data found."})})]})};export{k as default};
