import{s as C,l as J,j as e,r as o,c as D,u as K,a as Z,b as X,d as ee,e as te}from"./main-vUWWkE0C.js";import{O as re,c as ae,s as A}from"./toast-Bz8kE2N1.js";class se{async fetchLeaderboardData(){try{const{data:x,error:g}=await C.from("legacy_results").select(`
          id,
          legacy_competition_id,
          bartender_id,
          placement,
          points,
          status,
          competition_category,
          legacy_competitions (
            id,
            name,
            date,
            category
          )
        `).eq("status","approved");if(g)throw g;const{data:w,error:u}=await C.from("bartenders").select(`
          id, 
          full_name,
          rating,
          rating_rd,
          rating_volatility,
          ranking,
          speed_rating,
          speed_rd,
          speed_volatility,
          speed_ranking,
          traditional_rating,
          traditional_rd,
          traditional_volatility,
          traditional_ranking,
          flair_rating,
          flair_rd,
          flair_volatility,
          flair_ranking
        `).eq("is_approved",!0).not("is_archived","eq",!0);if(u)throw u;const a={legacy:new Set,speed:new Set,traditional:new Set,flair:new Set};return x.forEach(t=>{var j;if(!t.bartender_id)return;let c=t.competition_category||"legacy";!t.competition_category&&((j=t.legacy_competitions)!=null&&j.category)&&(c=t.legacy_competitions.category),a[c]?a[c].add(t.bartender_id):a.legacy.add(t.bartender_id)}),{legacy:w.filter(t=>a.legacy.has(t.id)&&t.rating!=null).sort((t,c)=>(c.rating||0)-(t.rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.rating,rating_rd:t.rating_rd,points:Math.round(t.rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),speed:w.filter(t=>a.speed.has(t.id)&&t.speed_rating!=null).sort((t,c)=>(c.speed_rating||0)-(t.speed_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.speed_rating,rating_rd:t.speed_rd,points:Math.round(t.speed_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),traditional:w.filter(t=>a.traditional.has(t.id)&&t.traditional_rating!=null).sort((t,c)=>(c.traditional_rating||0)-(t.traditional_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.traditional_rating,rating_rd:t.traditional_rd,points:Math.round(t.traditional_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),flair:w.filter(t=>a.flair.has(t.id)&&t.flair_rating!=null).sort((t,c)=>(c.flair_rating||0)-(t.flair_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.flair_rating,rating_rd:t.flair_rd,points:Math.round(t.flair_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'}))}}catch(x){return J(x),{legacy:[],traditional:[],flair:[],speed:[]}}}}const ie=new se,ne=e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"7",r:"4"}),e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),H=10;function oe({data:m=[],type:x="legacy",filter:g="rating",currentPage:w=0,onPageChange:u,searchActive:a=!1,onHistoryClick:t=()=>{}}){const c=n=>Math.round(n.rating||0),j="Rating",b=a?0:w*H,r=a?m.slice(0,Math.min(50,m.length)):m.slice(b,b+H),h=a?1:Math.ceil(m.length/H),f=w<h-1,y=w>0,S=n=>n%2===0?"bg-zinc-850":"bg-zinc-800";return e.jsxs("div",{className:"overflow-x-auto rounded-lg shadow",children:[e.jsxs("table",{className:"leaderboard-table min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-zinc-700",children:e.jsx("tr",{children:["Rank","Profile","Name",j].map(n=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:n},n))})}),e.jsxs("tbody",{className:"divide-y divide-gray-700",children:[r.map((n,s)=>e.jsxs("tr",{className:`${S(s)} hover:bg-zinc-700 cursor-pointer`,onClick:()=>t(n),children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:a?s+1:b+s+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"profile-pic h-10 w-10 bg-zinc-600 rounded-full flex items-center justify-center border border-gray-500 hover:border-white transition-colors",onClick:l=>{l.stopPropagation(),t(n)},title:`History for ${n.name}`,children:ne})}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:n.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-white font-medium",children:c(n)})]},n.id||s)),!a&&(f||y)&&e.jsx("tr",{className:"pagination-row bg-zinc-800",children:e.jsx("td",{colSpan:"4",className:"text-center py-3 px-4 border-t border-gray-700",children:e.jsxs("div",{className:"pagination-controls flex justify-center gap-3",children:[y&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"pagination-button",onClick:()=>u(0),children:"Top 10"}),e.jsx("button",{className:"pagination-button",onClick:()=>u(w-1),children:"Previous 10"})]}),f&&e.jsx("button",{className:"pagination-button",onClick:()=>u(w+1),children:"Next 10"})]})})}),a&&m.length>50&&e.jsx("tr",{className:"bg-zinc-800",children:e.jsx("td",{colSpan:"4",className:"text-center py-3 px-4 text-gray-400 border-t border-gray-700",children:"Showing top 50 results. Please refine your search."})})]})]}),m.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 italic",children:a?"No bartenders match your search.":"No competitors found yet."}),!a&&m.length>0&&r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 italic",children:"No more results on this page."})]})}const Y=({isOpen:m,onClose:x,title:g,children:w,maxWidth:u="max-w-xl"})=>{if(o.useEffect(()=>{const t=c=>{c.key==="Escape"&&x()};return m?(document.addEventListener("keydown",t),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[m,x]),!m)return null;const a=t=>{t.target===t.currentTarget&&x()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 transition-opacity duration-300 ease-in-out",onClick:a,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`bg-zinc-800 rounded-lg shadow-xl w-full ${u} max-h-[90vh] overflow-hidden flex flex-col`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-700 flex-shrink-0",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-white",children:g||"Modal"}),e.jsx("button",{type:"button",onClick:x,className:"text-gray-400 hover:text-white text-2xl leading-none font-bold focus:outline-none p-1","aria-label":"Close modal",children:"×"})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-grow",children:w})]})})},U=D("CompetitionHistoryModalContent"),le=({bartenderId:m,bartenderName:x})=>{const[g,w]=o.useState([]),[u,a]=o.useState(!0),[t,c]=o.useState(null);o.useEffect(()=>{(async()=>{if(!m){a(!1),c("Bartender ID is missing.");return}a(!0),c(null),U.debug(`Fetching history for bartender ID: ${m}`);try{const{data:r,error:h}=await C.from("legacy_results").select(`placement,
             post_competition_rating,
             pre_competition_rating,
             legacy_competition_id,
             legacy_competitions (
               id,
               name,
               date
             )`).eq("bartender_id",m).order("date",{ascending:!1,foreignTable:"legacy_competitions"});if(h)throw h;U.debug("Fetched competition history",{bartenderId:m,resultCount:r==null?void 0:r.length}),w(r||[])}catch(r){U.error("Error fetching competition history:",{bartenderId:m,error:r}),c(`Failed to load competition history: ${r.message}. Please try again.`)}finally{a(!1)}})()},[m]);const j=(b,r)=>b==null||r==null?"?":Math.round(r-b);return e.jsx("div",{className:"competition-history-content max-h-[70vh] overflow-y-auto pr-2",children:u?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx("div",{className:"animate-spin h-6 w-6 border-4 border-white rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-3 text-gray-300",children:"Loading history..."})]}):t?e.jsx("div",{className:"text-red-400 p-4 text-center bg-black/50 rounded border border-red-500",children:t}):g.length===0?e.jsxs("div",{className:"text-gray-400 p-6 text-center italic",children:["No competition history found for ",x,"."]}):e.jsxs("table",{className:"competition-history-table min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Competition"}),e.jsx("th",{className:"text-center",children:"Placement"}),e.jsx("th",{className:"text-center",children:"Rating Change"})]})}),e.jsx("tbody",{children:g.map((b,r)=>{var n,s,l;const h=j(b.pre_competition_rating,b.post_competition_rating),f=(n=b.legacy_competitions)!=null&&n.date?new Date(b.legacy_competitions.date).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"}):"Unknown Date",y=h==="?"?"text-gray-400":h>0?"text-white":"text-gray-400",S=(s=b.legacy_competitions)!=null&&s.id?`${b.legacy_competitions.id}-${r}`:r;return e.jsxs("tr",{className:"even:bg-zinc-800 odd:bg-gradient-to-b from-zinc-800 to-zinc-900",children:[e.jsx("td",{className:"text-sm text-gray-300 whitespace-nowrap",children:f}),e.jsx("td",{className:"text-sm text-white",children:((l=b.legacy_competitions)==null?void 0:l.name)||"Unknown Competition"}),e.jsx("td",{className:"text-sm text-center text-gray-300",children:b.placement||"N/A"}),e.jsx("td",{className:`text-sm text-center font-medium ${y}`,children:h>=0?`+${h}`:h})]},S)})})]})})};function I({id:m,title:x,type:g,data:w=[],page:u,filter:a,onPageChange:t,onFilterChange:c,showFilters:j=!1,showClaimButton:b=!1,hasPendingClaim:r=!1,comingSoon:h=!1,onClaimProfileClick:f,onSubmitResultClick:y}){const[S,n]=o.useState(""),[s,l]=o.useState(!1),[d,N]=o.useState(null),E=S.trim()?w.filter(k=>k.name.toLowerCase().includes(S.toLowerCase())):w,T=10,F=u*T,$=E.slice(F,F+T),R=k=>{N(k),l(!0)},i=()=>{N(null),l(!1)},v=k=>{n(k.target.value),u!==0&&t(g,0)},P=()=>n(""),z="px-4 py-2 rounded border transition-colors duration-200",p=`${z} bg-white text-black border-white hover:bg-zinc-200 hover:border-gray-200`,_=`${z} bg-transparent text-white border-gray-500 hover:bg-zinc-700`,L=`${z} bg-white text-black border-white`;return e.jsxs("div",{id:m,className:`leaderboard-container ${h?"coming-soon":""} mb-12`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-white",children:x}),!h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"search-container mb-4",children:[e.jsxs("div",{className:"relative w-full sm:w-1/4",children:[e.jsx("input",{type:"text",placeholder:"// search...",value:S,onChange:v,className:"w-full p-2 pl-10 bg-zinc-700 text-white rounded border border-gray-600 focus:border-gray-500 focus:outline-none"}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:`M8 4a4 4 0 100 8 4 4 0 000-8zM2 \r
                       8a6 6 0 1110.89 3.476l4.817\r
                       4.817a1 1 0 01-1.414 \r
                       1.414l-4.816-4.816A6 6 0 012 8z`,clipRule:"evenodd"})})}),S&&e.jsx("button",{className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white",onClick:P,children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:`M10 18a8 8 0 100-16 8 8 0 000 \r
                         16zM8.707 7.293a1 1 0 00-1.414 \r
                         1.414L8.586 10l-1.293 1.293a1 1 \r
                         0 101.414 1.414L10 11.414l1.293 \r
                         1.293a1 1 0 001.414-1.414L11.414 \r
                         10l1.293-1.293a1 1 0 00-1.414-1.414L10 \r
                         8.586 8.707 7.293z`,clipRule:"evenodd"})})})]}),S&&E.length===0?e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["No results for “",S,"”"]}):S?e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["Found ",E.length," ",E.length===1?"result":"results"]}):null]}),e.jsxs("div",{className:"button-container flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[j&&e.jsx("div",{className:"filter-buttons flex gap-2",children:e.jsx("button",{className:a==="rating"?L:_,onClick:()=>c(g,"rating"),children:"Rating"})}),g==="legacy"&&e.jsxs("div",{className:"action-buttons flex gap-2",children:[b&&f&&(r?e.jsx("button",{className:`${p} bg-zinc-600 text-gray-400 border-gray-600 cursor-not-allowed opacity-70`,disabled:!0,children:"Claim Pending"}):e.jsx("button",{className:p,onClick:f,children:"Claim Profile"})),y&&e.jsx("button",{className:p,onClick:y,children:"Submit Result"})]})]})]}),e.jsxs("div",{className:"leaderboard-content",children:[e.jsx(oe,{data:E,type:g,filter:a,currentPage:u,onPageChange:k=>t(g,k),searchActive:!!S.trim(),onHistoryClick:R}),e.jsxs("div",{className:"record-cards",children:[$.map((k,q)=>e.jsxs("div",{className:"record-card",onClick:()=>R(k),role:"button",tabIndex:0,onKeyPress:O=>O.key==="Enter"&&R(k),children:[e.jsx("div",{className:"rank",children:F+q+1}),e.jsx("div",{className:"pic",children:e.jsx("div",{className:"profile-pic",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:`M5.121 17.804A9.969 9.969 0 \r
                         0112 15c2.387 0 4.58.834 6.364 \r
                         2.197M15 7a3 3 0 11-6 \r
                         0 3 3 0 016 0z`})})})}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"name",children:k.name}),e.jsx("div",{className:"rating",children:Math.round(k.rating||0)})]})]},k.id||q)),e.jsxs("div",{className:"pagination-row",children:[F>0&&e.jsx("button",{className:"pagination-button",onClick:()=>t(g,u-1),children:"Previous 10"}),F+T<E.length&&e.jsx("button",{className:"pagination-button",onClick:()=>t(g,u+1),children:"Next 10"})]})]})]}),e.jsx(Y,{isOpen:s,onClose:i,title:`${(d==null?void 0:d.name)||"Bartender"}'s Competition History`,maxWidth:"max-w-4xl",children:d&&e.jsx(le,{bartenderId:d.id,bartenderName:d.name})})]})}const V=D("BartenderSelect"),W=({value:m,onSelect:x,placeholder:g="Select a bartender",initialLabel:w="",excludeIds:u=[]})=>{const[a,t]=o.useState(w),[c,j]=o.useState(!1),[b,r]=o.useState([]),[h,f]=o.useState(!1),[y,S]=o.useState(null);o.useEffect(()=>{if(!a.trim()){r([]);return}const d=setTimeout(async()=>{f(!0);try{let N=C.from("bartenders").select("id, full_name, is_approved").ilike("full_name",`%${a}%`).is("is_archived",!1);u.length>0&&(N=N.not("id","in",`(${u.join(",")})`));const{data:E,error:T}=await N.limit(5);if(T)throw T;r(E||[])}catch(N){V.error("Failed to load bartenders:",N),S("Failed to load bartenders")}finally{f(!1)}},300);return()=>clearTimeout(d)},[a,u.join(",")]);const n=l=>{t(l.full_name),j(!1),x(l)},s=async()=>{try{const{data:{user:l}}=await C.auth.getUser();if(!l)throw new Error("Please sign in to add a new bartender");const{data:d,error:N}=await C.from("bartenders").insert({full_name:a.trim(),bar:"",rating:1500,rating_rd:350,rating_volatility:.06,is_profile_claimed:!1,is_approved:!1}).select().single();if(N)throw N;V.info("Created new bartender:",{id:d.id,name:d.full_name}),alert("New bartender created! Note: Bartenders need to be approved by an administrator before appearing on leaderboards."),t(d.full_name),j(!1),x(d)}catch(l){V.error("Error adding new bartender:",l),S(l.message)}};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a,onChange:l=>{t(l.target.value),j(!0)},onClick:()=>j(!0),placeholder:g,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),c&&(a.trim()||h||y)&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg",children:[h&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),y&&e.jsx("div",{className:"p-2 text-red-400",children:y}),!h&&!y&&b.length>0&&e.jsxs("div",{children:[b.map(l=>e.jsx("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>n(l),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:l.full_name}),l.is_approved===!1&&e.jsx("span",{className:"text-xs text-yellow-400 px-2 py-1 bg-zinc-800 rounded",children:"Pending"})]})},l.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),a.trim()&&e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:s,children:[e.jsxs("span",{children:['+ Add "',a.trim(),'" as new bartender']}),e.jsx("span",{className:"text-gray-400",children:"→"})]}),!h&&!y&&a.trim()&&b.length===0&&!y&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"No matching bartenders found"})]})]})},B=D("ClaimForm"),ce=({onSuccess:m,onError:x})=>{const[g,w]=o.useState(null),[u,a]=o.useState(!1),[t,c]=o.useState(null),[j,b]=o.useState(!1),[r,h]=o.useState(null);o.useEffect(()=>{f()},[]);const f=async()=>{try{a(!0);const{data:{user:n}}=await C.auth.getUser();if(!n)return;const{data:s,error:l}=await C.from("submissions").select("id, status, content").eq("user_id",n.id).eq("status","pending").like("content",'%"type":"profile_claim"%').maybeSingle();if(l&&l.code!=="PGRST116")throw l;if(s){B.info("Found existing pending claim",{submissionId:s.id}),c(s);return}const{data:d,error:N}=await C.from("bartenders").select("id, is_profile_claimed").eq("user_id",n.id).single();if(N&&N.code!=="PGRST116")throw N;d!=null&&d.is_profile_claimed&&(B.info("User already has a claimed profile",{bartenderId:d.id}),m==null||m({alreadyClaimed:!0}))}catch(n){B.error("Error checking existing claim:",n),h(n.message),x==null||x(n.message)}finally{a(!1)}},y=async n=>{n.preventDefault(),a(!0),h(null),b(!1);try{const{data:{user:s}}=await C.auth.getUser();if(!s)throw new Error("Authentication required");if(!g)throw new Error("Please select a bartender profile");const{data:l,error:d}=await C.from("bartenders").select("is_profile_claimed, users_attempting_to_claim").eq("id",g.id).single();if(d)throw d;if(l!=null&&l.is_profile_claimed)throw new Error("This profile has already been claimed");const N=l.users_attempting_to_claim||[];if(!N.includes(s.id)){const{error:T}=await C.from("bartenders").update({users_attempting_to_claim:[...N,s.id]}).eq("id",g.id);if(T)throw T}const{error:E}=await C.from("submissions").insert({user_id:s.id,content:JSON.stringify({type:"profile_claim",bartender_id:g.id,bartender_name:g.full_name,submitted_at:new Date().toISOString()}),status:"pending"});if(E)throw E;b(!0),B.info("Profile claim submitted successfully",{userId:s.id,bartenderId:g.id}),setTimeout(()=>{m==null||m()},2e3)}catch(s){h(s.message),x==null||x(s.message),B.error("Error submitting profile claim:",s)}finally{a(!1)}},S=async()=>{if(t){a(!0);try{const{data:{user:n}}=await C.auth.getUser();if(!n)throw new Error("Authentication required");let s=null;try{s=JSON.parse(t.content).bartender_id}catch(d){B.error("Error parsing claim content:",d)}if(s){const{data:d}=await C.from("bartenders").select("users_attempting_to_claim").eq("id",s).single();if(d){const N=(d.users_attempting_to_claim||[]).filter(E=>E!==n.id);await C.from("bartenders").update({users_attempting_to_claim:N}).eq("id",s)}}const{error:l}=await C.from("submissions").update({status:"cancelled"}).eq("id",t.id);if(l)throw l;c(null),m==null||m({cancelled:!0}),B.info("Claim cancelled successfully",{submissionId:t.id})}catch(n){h(n.message),x==null||x(n.message),B.error("Error cancelling claim:",n)}finally{a(!1)}}};return t?e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl text-white mb-4",children:"Pending Profile Claim"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Your profile claim is currently under review by an administrator."}),e.jsx("button",{onClick:S,disabled:u,className:"w-full py-2 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Processing...":"Cancel Claim"})]}):e.jsxs("form",{onSubmit:y,className:"p-6",method:"POST",children:[e.jsx("h3",{className:"text-xl text-white mb-6",children:"Claim Your Profile"}),r&&e.jsx("div",{className:"error-message mb-4 p-3 bg-red-500/20 border border-red-500 rounded text-red-200",children:r}),j&&e.jsx("div",{className:"success-message mb-4 p-3 bg-green-500/20 border border-green-500 rounded text-green-200",children:"Profile claim submitted successfully! Your claim will be reviewed by an administrator."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white mb-2",children:"Select Your Profile"}),e.jsx(W,{onSelect:w,placeholder:"Search for your profile",unclaimedOnly:!0})]}),e.jsx("button",{type:"submit",disabled:u||!g||j,className:"w-full py-3 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Submitting...":"Submit Claim"})]})},de=({onSelect:m,placeholder:x="Search for competition"})=>{const[g,w]=o.useState(""),[u,a]=o.useState(!1),[t,c]=o.useState([]),[j,b]=o.useState(!1),[r,h]=o.useState(null);o.useEffect(()=>{if(!g.trim()){c([]);return}const S=setTimeout(async()=>{b(!0);try{const{data:n,error:s}=await C.from("legacy_competitions").select("id, name, date, venue").ilike("name",`%${g}%`).order("date",{ascending:!1}).limit(5);if(s)throw s;c(n||[])}catch(n){console.error("Error fetching competitions:",n),h("Failed to load competitions")}finally{b(!1)}},300);return()=>clearTimeout(S)},[g]);const f=()=>{m({name:g.trim(),isNew:!0}),w(g.trim()),a(!1)};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:g,onChange:y=>{w(y.target.value),a(!0)},onClick:()=>a(!0),placeholder:x,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),u&&g.trim()&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg max-h-60 overflow-y-auto",children:[j&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),r&&e.jsx("div",{className:"p-2 text-red-400",children:r}),!j&&!r&&t.length>0&&e.jsxs("div",{children:[t.map(y=>e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>{m(y),w(y.name),a(!1)},children:[e.jsx("div",{children:y.name}),e.jsxs("div",{className:"text-gray-400 text-sm",children:[new Date(y.date).toLocaleDateString()," - ",y.venue]}),e.jsx("hr",{className:"border-t border-gray-700 mt-2"})]},y.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:f,children:[e.jsxs("span",{children:['+ Add "',g.trim(),'" as new competition']}),e.jsx("span",{className:"text-gray-400",children:"→"})]})]})]})},G=D("VenueSelect"),me=({value:m,onSelect:x,placeholder:g="Select a venue",initialLabel:w=""})=>{const[u,a]=o.useState(w),[t,c]=o.useState(!1),[j,b]=o.useState([]),[r,h]=o.useState(!1),[f,y]=o.useState(null);o.useEffect(()=>{if(!u.trim()){b([]);return}const l=setTimeout(async()=>{h(!0);try{const{data:d,error:N}=await C.from("venues").select("id, name, city, country").ilike("name",`%${u}%`).is("is_archived",!1).order("name").limit(5);if(N)throw N;b(d||[])}catch(d){G.error("Failed to load venues:",d),y("Failed to load venues")}finally{h(!1)}},300);return()=>clearTimeout(l)},[u]);const S=s=>{a(s.name),c(!1),x(s)},n=async()=>{try{const{data:{user:s}}=await C.auth.getUser();if(!s)throw new Error("Please sign in to add a new venue");const{data:l,error:d}=await C.from("venues").insert({name:u.trim(),created_by:s.id}).select().single();if(d)throw d;G.info("Created new venue:",{id:l.id,name:l.name}),a(l.name),c(!1),x(l)}catch(s){G.error("Error adding new venue:",s),y(s.message)}};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u,onChange:s=>{a(s.target.value),c(!0)},onClick:()=>c(!0),placeholder:g,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),t&&(u.trim()||r||f)&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg",children:[r&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),f&&e.jsx("div",{className:"p-2 text-red-400",children:f}),!r&&!f&&j.length>0&&e.jsxs("div",{children:[j.map(s=>e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>S(s),children:[e.jsx("div",{children:s.name}),s.city&&s.country&&e.jsxs("div",{className:"text-gray-400 text-sm",children:[s.city,", ",s.country]})]},s.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),u.trim()&&e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:n,children:[e.jsxs("span",{children:['+ Add "',u.trim(),'" as new venue']}),e.jsx("span",{className:"text-gray-400",children:"→"})]}),!r&&!f&&u.trim()&&j.length===0&&!f&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"No matching venues found"})]})]})},ue=[{id:"state final",label:"State Final"},{id:"national final",label:"National Final"},{id:"global final",label:"Global Final"}],ge=({onSuccess:m,onError:x})=>{const[g,w]=o.useState(!1),[u,a]=o.useState(""),[t,c]=o.useState([{id:"",position:""}]),[j,b]=o.useState(!1),[r,h]=o.useState({date:"",venue_id:"",venue_name:"",organizer_id:"",organizer_name:"",source_url:"",category:"legacy",country:"",round:"state final"}),[f,y]=o.useState(null),[S,n]=o.useState(!1),s=()=>{const{organizer_name:i,date:v,round:P,country:z}=r,p=(f==null?void 0:f.name)||"";if(!v||!i||!p||!P)return null;const _=new Date(v).getFullYear();return`${i} ${p} ${_} ${P} ${z||""}`.trim()},l=i=>{y(i),b(!(i!=null&&i.id)),i!=null&&i.id&&h(v=>({...v,date:i.date,venue_id:i.venue_id,venue_name:i.venue,organizer_id:i.organizer,category:i.category||"legacy",country:i.country||""}))},d=async i=>{try{const{data:v}=await C.from("organisers").select("organisation_name").eq("id",i.id).single();h(P=>({...P,organizer_id:i.id,organizer_name:(v==null?void 0:v.organisation_name)||""}))}catch(v){console.error("Error fetching organizer details:",v),a("Error fetching organizer details")}},N=i=>{h(v=>({...v,venue_id:i.id,venue_name:i.name}))},E=i=>({1:25,2:15,3:15,4:12,5:10,6:8,7:6,8:4,9:2,10:1})[i]||0,T=async i=>{i.preventDefault(),w(!0),a(""),n(!1);try{const{data:{user:v},error:P}=await C.auth.getUser();if(P)throw new Error("Authentication error");if(!v)throw new Error("Please sign in to submit results");if(j){if(!r.date)throw new Error("Date is required");if(!r.organizer_id)throw new Error("Organizer is required");if(!r.venue_id)throw new Error("Venue is required");if(!(f!=null&&f.name))throw new Error("Competition name is required");if(!r.round)throw new Error("Competition round is required")}let z;if(f!=null&&f.id)z=f.id;else{const _=s();if(!_)throw new Error("Unable to generate competition name - missing required fields");const{data:L,error:k}=await C.from("legacy_competitions").insert({name:_,date:r.date,venue:r.venue_name,venue_id:r.venue_id,organizer:r.organizer_id,category:r.category,country:r.country||null,created_by:v.id,status:"pending"}).select().single();if(k)throw k;z=L.id}const p=t.filter(_=>_.id&&_.position);if(p.length===0)throw new Error("At least one competitor with position is required");for(const _ of p){const{error:L}=await C.from("legacy_results").insert({legacy_competition_id:z,bartender_id:_.id,placement:parseInt(_.position,10),points:E(parseInt(_.position,10)),status:"pending",created_by:v.id,competition_category:r.category});if(L)throw L}if(r.source_url){const{error:_}=await C.from("sources").insert({legacy_competition_id:z,url:r.source_url,created_by:v.id});if(_)throw _}n(!0),setTimeout(()=>{F(),m==null||m()},2e3)}catch(v){console.error("Submission error:",v),a(v.message),x==null||x(v.message)}finally{w(!1)}},F=()=>{h({date:"",venue_id:"",venue_name:"",organizer_id:"",organizer_name:"",source_url:"",category:"legacy",country:"",round:"state final"}),y(null),c([{id:"",position:""}]),b(!1),n(!1)},$=()=>{c(i=>[...i,{id:"",position:""}])},R=i=>{c(v=>v.filter((P,z)=>z!==i))};return e.jsxs("div",{className:"p-6 bg-zinc-800 rounded-lg",children:[e.jsx("h3",{className:"text-xl text-white mb-6",children:"Submit Competition Result"}),u&&e.jsx("div",{className:"error-message mb-4 p-3 bg-red-500/20 border border-red-500 rounded text-red-200",children:u}),S&&e.jsx("div",{className:"success-message mb-4 p-3 bg-green-500/20 border border-green-500 rounded text-green-200",children:"Competition result submitted successfully! Your submission will be reviewed by an administrator."}),e.jsxs("form",{onSubmit:T,className:"space-y-6",method:"POST",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Competition *"}),e.jsx(de,{onSelect:l,placeholder:"Search or add competition"})]}),j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Organizer *"}),e.jsx(re,{onSelect:d,placeholder:"Select organizer"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Venue *"}),e.jsx(me,{onSelect:N,placeholder:"Select or add venue"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Round *"}),e.jsx("select",{value:r.round,onChange:i=>h({...r,round:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,children:ue.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Category *"}),e.jsxs("select",{value:r.category,onChange:i=>h({...r,category:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,children:[e.jsx("option",{value:"legacy",children:"Legacy Competition"}),e.jsx("option",{value:"speed",children:"Speed"}),e.jsx("option",{value:"flair",children:"Flair"}),e.jsx("option",{value:"traditional",children:"Traditional"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Country"}),e.jsxs("select",{value:r.country,onChange:i=>h({...r,country:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",children:[e.jsx("option",{value:"",children:"Select country"}),ae.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Date *"}),e.jsx("input",{type:"date",value:r.date,onChange:i=>h({...r,date:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Source URL *"}),e.jsx("input",{type:"url",value:r.source_url,onChange:i=>h({...r,source_url:i.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,placeholder:"Link to competition results"})]}),e.jsxs("div",{className:"competitors-section mt-8",children:[e.jsx("h3",{className:"text-lg text-white mb-4",children:"Competitors *"}),t.map((i,v)=>e.jsxs("div",{className:"competitor-entry mb-4 p-4 bg-zinc-700 rounded",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-2",children:"Competitor Name *"}),e.jsx(W,{onSelect:P=>{const z=[...t];z[v].id=P.id,c(z)},placeholder:"Search for competitor"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-2",children:"Position *"}),e.jsx("input",{type:"number",value:i.position,onChange:P=>{const z=[...t];z[v].position=P.target.value,c(z)},className:"w-full p-2 bg-zinc-600 text-white rounded border border-gray-500",required:!0,min:"1"})]}),v>0&&e.jsx("button",{type:"button",onClick:()=>R(v),className:"text-red-400 hover:text-red-300 px-4 py-2 border border-red-500 rounded hover:bg-red-500/20 transition-colors",children:"Remove Competitor"})]},v)),e.jsx("button",{type:"button",onClick:$,className:"w-full p-2 border border-gray-400 text-gray-300 rounded hover:bg-zinc-700 transition-colors",children:"Add Competitor"})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full p-3 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Submitting...":"Submit Result"})]})]})},M=ee("HomePage"),pe=()=>{var z;const[m,x]=o.useState({legacy:[],traditional:[],flair:[],speed:[]}),[g,w]=o.useState(!0),[u,a]=o.useState(null),{user:t,isAuthenticated:c,profile:j,loading:b}=K(),[r,h]=o.useState(!1),[f,y]=o.useState({legacy:{page:0,filter:"rating"},speed:{page:0,filter:"rating"},traditional:{page:0,filter:"rating"},flair:{page:0,filter:"rating"}}),[S,n]=o.useState(!1),[s,l]=o.useState(!1),d=Z(),N=X(),E=(z=d.state)==null?void 0:z.scrollTo;o.useEffect(()=>{(async()=>{if(!c||!t){h(!1);return}try{const{data:_,error:L}=await te.from("submissions").select("id, status").eq("user_id",t.id).eq("status","pending").like("content",'%"type":"profile_claim"%').maybeSingle();if(L)throw L;h(!!_),M.debug("Pending claim check result:",{hasPendingClaim:!!_})}catch(_){M.error("Error checking pending claims:",_)}})()},[c,t]);const T=o.useCallback(async()=>{w(!0),a(null),M.info("Fetching leaderboard data...");try{const p=await ie.fetchLeaderboardData();x({legacy:(p==null?void 0:p.legacy)||[],traditional:(p==null?void 0:p.traditional)||[],flair:(p==null?void 0:p.flair)||[],speed:(p==null?void 0:p.speed)||[]}),M.info("Leaderboard data fetched successfully")}catch(p){M.error("Error fetching leaderboard data:",p),a("Failed to load leaderboard data. Please try again later."),x({legacy:[],traditional:[],flair:[],speed:[]})}finally{w(!1)}},[]);o.useEffect(()=>{T()},[T]),o.useEffect(()=>{if(E){M.debug(`Scrolling to section: ${E}`);const p=document.getElementById(`${E}-section`),_=document.querySelector(".column-right");if(p&&_){const L=p.offsetTop,k=parseFloat(getComputedStyle(_).paddingTop||"0"),q=L-k;M.debug(`Target offsetTop: ${L}, Container padding: ${k}, Effective scroll: ${q}`);const O=setTimeout(()=>{_.scrollTo({top:q,behavior:"smooth"}),N(d.pathname,{replace:!0,state:{...d.state,scrollTo:null}})},150);return()=>clearTimeout(O)}else M.warn(`Scroll target #${E}-section or .column-right not found`),N(d.pathname,{replace:!0,state:{...d.state,scrollTo:null}})}},[E,d.pathname,d.state,N]);const F=(p,_)=>{y(q=>({...q,[p]:{...q[p],page:_}}));const L=document.getElementById(`${p}-section`),k=document.querySelector(".column-right");if(L&&k){const q=L.offsetTop,O=parseFloat(getComputedStyle(k).paddingTop||"0"),Q=q-O;k.scrollTo({top:Q,behavior:"smooth"})}},$=(p,_)=>{y(L=>({...L,[p]:{...L[p],filter:_,page:0}}))},R=()=>{if(!c){A("Please sign in or create an account to claim a profile."),N("/enter",{state:{from:d}});return}n(!0),M.info("Claim Profile modal opened")},i=()=>{if(!c){A("Please sign in or create an account to submit results."),N("/enter",{state:{from:d}});return}l(!0),M.info("Submit Result modal opened")},P=!(c&&(j==null?void 0:j.is_profile_claimed)===!0)&&!r;return g||b?e.jsxs("div",{className:"flex justify-center items-center h-screen col-span-2",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-white rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-4 text-gray-300",children:"Loading Leaderboards..."})]}):u?e.jsx("div",{className:"text-center p-10 text-red-400 col-span-2",children:u}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"column-left hidden md:flex",children:[" ",e.jsxs("div",{className:"column-left-content text-white p-8",children:[" ",e.jsx("div",{style:{height:"calc(100vh * 4 / 13)",minHeight:"200px",flexShrink:0}}),c&&j?e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Welcome, ",j.full_name||"Competitor","!"]}):e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"PROFESSIONAL BARTENDING. A NEW GLOBAL SPORT."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"Our goal is to transform one of the worlds oldest professions into a thrilling, worldwide competition by uniting bartenders, bars, and brands under one transparent ranking system."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"These leaderboards rank bartenders with registered competition results. Legacy competitions are events held by brand organisers - the ones most bartenders are familiar with. MBC Speed, Traditional and Flair and MBC sanctioned events that adhere to guidelines of fairness, transparency and integrity."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To add yourself to the leaderboard, click 'submit result'."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To find out more about our pillars and goals, click the about section of our site menu."}),e.jsxs("p",{className:"text-gray-400 text-sm mt-8",children:["This service is created and maintained by passionate bartenders out of ",e.jsx("a",{href:"http://www.trapadl.com",className:"text-white hover:text-gray-300",target:"_blank",rel:"noopener noreferrer",children:"trap. cocktail bar"})," in Adelaide, Australia. It's constantly undergoing improvements. Feedback, bug reports, or contribution inquiries are welcome via ",e.jsx("a",{href:"mailto:cocktails+mbc@trapadl.com",className:"text-white hover:text-gray-300",children:"cocktails+mbc@trapadl.com"}),"."]})]})]}),e.jsxs("div",{className:"column-right w-full md:w-1/2",children:[" ",e.jsxs("div",{className:"column-right-content space-y-12 p-4 md:p-8 ",children:[" ",e.jsx(I,{id:"legacy-section",title:"Legacy Leaderboard",type:"legacy",data:m.legacy,page:f.legacy.page,filter:f.legacy.filter,onPageChange:F,onFilterChange:$,showFilters:!1,showClaimButton:P,hasPendingClaim:r,onClaimProfileClick:R,onSubmitResultClick:i}),e.jsx(I,{id:"speed-section",title:"MBC Speed Leaderboard",type:"speed",data:m.speed,page:f.speed.page,filter:f.speed.filter,onPageChange:F,onFilterChange:$}),e.jsx(I,{id:"traditional-section",title:"MBC Traditional Leaderboard",type:"traditional",data:m.traditional,page:f.traditional.page,filter:f.traditional.filter,onPageChange:F,onFilterChange:$,comingSoon:!0}),e.jsx(I,{id:"flair-section",title:"MBC Flair Leaderboard",type:"flair",data:m.flair,page:f.flair.page,filter:f.flair.filter,onPageChange:F,onFilterChange:$,comingSoon:!0})]})]}),e.jsx(Y,{isOpen:S,onClose:()=>n(!1),title:"Claim Your Profile",children:e.jsx(ce,{onSuccess:()=>{M.info("Claim success callback triggered."),n(!1),h(!0),T()},onError:p=>M.error("Claim form error:",p)})}),e.jsx(Y,{isOpen:s,onClose:()=>l(!1),title:"Submit Competition Result",maxWidth:"max-w-2xl",children:e.jsx(ge,{onSuccess:()=>{M.info("Result success callback triggered."),l(!1),A("Result submitted for admin review!")},onError:p=>M.error("Result form error:",p)})})]})};export{pe as default};
