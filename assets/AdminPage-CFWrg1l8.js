import{r as n,s as I,j as e,c as G,R as K}from"./main-Do236Ahx.js";import{s as _,c as R,a as ne,O as le}from"./OrganizerSelect-BXb4Y9_J.js";import{a as X,b as Z}from"./toast-CesTQUbM.js";const ce=G("AdminTabsNav"),de=({activeTab:t,onTabChange:m})=>{n.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:{user:u}}=await I.auth.getUser();if(!u){window.location.href="/";return}const{data:d,error:p}=await I.from("bartenders").select("is_admin").eq("user_id",u.id).single();(p||!(d!=null&&d.is_admin))&&(window.location.href="/")}catch(u){ce.error("Error verifying admin access:",u),window.location.href="/"}},l=[{id:"results",label:"Competition Results",description:"Review and manage competition results"},{id:"bartenders",label:"Bartenders",description:"Manage bartender profiles and rankings"},{id:"organisers",label:"Organisers",description:"Manage competition organisers"},{id:"profile_claims",label:"Profile Claims",description:"Review and manage profile claims"},{id:"glicko_ratings",label:"Glicko Ratings"}];return e.jsx("nav",{className:"flex space-x-1 mb-6 bg-zinc-800 p-1 rounded-lg overflow-x-auto",role:"tablist","aria-label":"Admin sections",children:l.map(u=>e.jsx("button",{onClick:()=>m(u.id),className:`
            px-4 py-2 rounded-md transition-colors whitespace-nowrap
            ${t===u.id?"bg-black text-white":"text-gray-300 hover:bg-zinc-700"}
          `,role:"tab","aria-selected":t===u.id,"aria-controls":`${u.id}-panel`,id:`${u.id}-tab`,title:u.description,children:u.label},u.id))})},L=G("AdminActions"),oe=({id:t,isEditing:m,onEdit:g,onSave:l,onCancel:u,onApprove:d,onDeny:p,showApproveButtons:w,disabled:h=!1})=>{const N=()=>{L.debug("Edit action triggered",{id:t}),g==null||g()},c=()=>{L.debug("Save action triggered",{id:t}),l==null||l()},a=()=>{L.debug("Cancel action triggered",{id:t}),u==null||u()},r=()=>{L.info("Approve action triggered",{id:t}),d==null||d()},x=()=>{L.info("Deny action triggered",{id:t}),p==null||p()};return e.jsx("div",{className:"flex gap-2 items-center",children:m?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,disabled:h,className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Save changes",children:"Save"}),e.jsx("button",{onClick:a,disabled:h,className:"bg-zinc-600 hover:bg-zinc-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Cancel editing",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:N,disabled:h,className:"bg-black hover:bg-blue-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Edit item",children:"Edit"}),w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,disabled:h,className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Approve item",children:"Approve"}),e.jsx("button",{onClick:x,disabled:h,className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Deny item",children:"Deny"})]})]})})},Q=R("BartendersTab"),ue=()=>{const[t,m]=n.useState([]),[g,l]=n.useState(!0),[u,d]=n.useState(null),[p,w]=n.useState(null),[h,N]=n.useState({}),[c,a]=n.useState(""),[r,x]=n.useState(1),[o,b]=n.useState(10),[f,s]=n.useState("created_at"),[y,C]=n.useState("desc"),[S,E]=n.useState("all");n.useEffect(()=>{A()},[f,y,S,r,o]);const A=async()=>{try{l(!0);let i=_.from("bartenders").select(`
          id,
          full_name,
          venue_id,
          venues(name),
          user_id,
          is_admin,
          is_approved,
          is_profile_claimed,
          is_archived,
          created_at,
          updated_at
        `);S==="approved"?i=i.eq("is_approved",!0):S==="unapproved"?i=i.eq("is_approved",!1):S==="archived"?i=i.eq("is_archived",!0):S==="active"&&(i=i.eq("is_archived",!1)),c&&(i=i.ilike("full_name",`%${c}%`)),i=i.order(f,{ascending:y==="asc"});const z=(r-1)*o,q=z+o-1;i=i.range(z,q);const{data:F,error:P,count:ze}=await i;if(P)throw P;m(F||[]);const{count:ie}=await _.from("bartenders").select("id",{count:"exact",head:!0});V(Math.ceil(ie/o))}catch(i){Q.error("Error fetching bartenders:",i),d(i.message)}finally{l(!1)}},[O,V]=n.useState(1),W=i=>{w(i.id),N({...i})},H=async()=>{try{l(!0);const{error:i}=await _.from("bartenders").update(h).eq("id",p);if(i)throw i;X("Bartender updated successfully"),await A(),w(null),N({})}catch(i){Q.error("Error saving bartender:",i),d(i.message),Z(`Error: ${i.message}`)}finally{l(!1)}},j=()=>{w(null),N({})},v=(i,z)=>{N(q=>({...q,[i]:z}))},k=async(i,z)=>{try{l(!0);let q={},F="";switch(z){case"approve":q={is_approved:!0},F="Bartender approved successfully";break;case"reject":q={is_approved:!1},F="Bartender rejected successfully";break;case"archive":q={is_archived:!0},F="Bartender archived successfully";break;case"unarchive":q={is_archived:!1},F="Bartender restored successfully";break;default:throw new Error("Invalid action")}const{error:P}=await _.from("bartenders").update(q).eq("id",i);if(P)throw P;X(F),await A()}catch(q){Q.error(`Error performing ${z} action:`,q),d(q.message),Z(`Error: ${q.message}`)}finally{l(!1)}},D=i=>{f===i?C(y==="asc"?"desc":"asc"):(s(i),C("asc"))},$=i=>f!==i?"↕":y==="asc"?"↑":"↓",M=(i,z,q="text")=>p===i.id?q==="checkbox"?e.jsx("input",{type:"checkbox",checked:h[z]||!1,onChange:P=>v(z,P.target.checked),className:"form-checkbox h-5 w-5 text-blue-600"}):e.jsx("input",{type:q,value:h[z]||"",onChange:P=>v(z,P.target.value),className:"w-full bg-zinc-700 text-white px-2 py-1 rounded"}):q==="checkbox"?e.jsx("span",{className:i[z]?"text-green-400":"text-red-400",children:i[z]?"Yes":"No"}):i[z]||e.jsx("span",{className:"text-gray-500",children:"—"});return g&&t.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-6 bg-zinc-800 p-4 rounded-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name...",value:c,onChange:i=>a(i.target.value),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{a(""),A()},className:"px-4 py-2 bg-black text-white rounded",children:"Search"}),e.jsxs("select",{value:S,onChange:i=>E(i.target.value),className:"p-2 bg-zinc-700 text-white rounded border border-gray-600",children:[e.jsx("option",{value:"all",children:"All Bartenders"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"unapproved",children:"Unapproved"}),e.jsx("option",{value:"active",children:"Active (Not Archived)"}),e.jsx("option",{value:"archived",children:"Archived"})]})]})]})}),u&&e.jsx("div",{className:"bg-red-900/50 border border-red-500 text-red-200 p-4 rounded-lg mb-6",children:u}),e.jsx("div",{className:"bg-zinc-800 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("full_name"),children:["Name ",$("full_name")]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("venues.name"),children:["Venue ",$("venues.name")]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_approved"),children:["Approved ",$("is_approved")]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_profile_claimed"),children:["Claimed ",$("is_profile_claimed")]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_admin"),children:["Admin ",$("is_admin")]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_archived"),children:["Archived ",$("is_archived")]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("created_at"),children:["Created ",$("created_at")]})}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:t.map(i=>{var z;return e.jsxs("tr",{className:i.is_archived?"opacity-50":"",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:M(i,"full_name")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:((z=i.venues)==null?void 0:z.name)||e.jsx("span",{className:"text-gray-500",children:"—"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:M(i,"is_approved","checkbox")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:M(i,"is_profile_claimed","checkbox")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:M(i,"is_admin","checkbox")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:M(i,"is_archived","checkbox")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400",children:new Date(i.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(oe,{id:i.id,isEditing:p===i.id,onEdit:()=>W(i),onSave:H,onCancel:j,disabled:g}),p!==i.id&&e.jsxs("div",{className:"flex gap-2 ml-2",children:[!i.is_approved&&e.jsx("button",{onClick:()=>k(i.id,"approve"),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white transition-colors",title:"Approve",children:"✓"}),i.is_approved&&e.jsx("button",{onClick:()=>k(i.id,"reject"),className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white transition-colors",title:"Reject",children:"✕"}),i.is_archived?e.jsx("button",{onClick:()=>k(i.id,"unarchive"),className:"bg-black hover:bg-white px-3 py-1 rounded text-white transition-colors",title:"Restore",children:"🔄"}):e.jsx("button",{onClick:()=>k(i.id,"archive"),className:"bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-white transition-colors",title:"Archive",children:"📦"})]})]})})]},i.id)})})]})})}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("select",{value:o,onChange:i=>{b(Number(i.target.value)),x(1)},className:"bg-zinc-700 text-white rounded p-2 border border-gray-600",children:[e.jsx("option",{value:10,children:"10 per page"}),e.jsx("option",{value:25,children:"25 per page"}),e.jsx("option",{value:50,children:"50 per page"}),e.jsx("option",{value:100,children:"100 per page"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x(i=>Math.max(i-1,1)),disabled:r===1,className:"px-3 py-1 bg-zinc-700 text-white rounded disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 bg-zinc-700 text-white rounded",children:["Page ",r," of ",O]}),e.jsx("button",{onClick:()=>x(i=>Math.min(i+1,O)),disabled:r===O,className:"px-3 py-1 bg-zinc-700 text-white rounded disabled:opacity-50",children:"Next"})]})]})]})},xe=({competition:t,onSave:m,onCancel:g})=>{const[l,u]=n.useState({name:t.name||"",date:t.date||"",venue:t.venue||"",country:t.country||""}),[d,p]=n.useState(!1),[w,h]=n.useState(!1),[N,c]=n.useState(null);n.useEffect(()=>{u({name:t.name||"",date:t.date||"",venue:t.venue||"",country:t.country||""}),p(!1),c(null)},[t]);const a=(o,b)=>{u(f=>({...f,[o]:b})),p(!0),c(null)},r=()=>{var b,f;if(!((b=l.name)!=null&&b.trim()))throw new Error("Competition name is required");if(!l.date)throw new Error("Competition date is required");if(!((f=l.venue)!=null&&f.trim()))throw new Error("Venue is required");const o=new Date(l.date);if(isNaN(o.getTime()))throw new Error("Invalid date format")},x=async()=>{if(!d){g();return}h(!0),c(null);try{r(),await m({...l,name:l.name.trim(),venue:l.venue.trim(),country:l.country||null,date:new Date(l.date).toISOString().split("T")[0]})}catch(o){c(o.message),h(!1);return}h(!1)};return e.jsxs("div",{className:"bg-zinc-700 rounded p-6",children:[N&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500 text-red-200 rounded",children:N}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-white mb-2",children:["Competition Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:l.name,onChange:o=>a("name",o.target.value),className:"w-full p-2 bg-zinc-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none",placeholder:"Enter competition name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-white mb-2",children:["Date ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"date",value:l.date,onChange:o=>a("date",o.target.value),className:"w-full p-2 bg-zinc-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-white mb-2",children:["Venue ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:l.venue,onChange:o=>a("venue",o.target.value),className:"w-full p-2 bg-zinc-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none",placeholder:"Enter venue name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white mb-2",children:"Country"}),e.jsxs("select",{value:l.country||"",onChange:o=>a("country",o.target.value),className:"w-full p-2 bg-zinc-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a country"}),ne.map(o=>e.jsx("option",{value:o,children:o},o))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:g,disabled:w,className:"px-4 py-2 bg-zinc-600 text-white rounded hover:bg-zinc-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:x,disabled:w||!d&&!N,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Saving...":"Save Changes"})]})]})},ee=R("ResultsTable"),me=t=>{if(!t)return"";t=t.replace(/^(https?:\/\/)/,""),t.startsWith("www.")&&(t=t.substring(4));const m=t.split("/").filter(Boolean),g=m[0],l=m[m.length-1]||"";return`${g}/../${l}`},he=({results:t=[],competitionStatus:m,onResultStatusChange:g})=>{ee.debug("Rendering results table",{resultCount:t==null?void 0:t.length,competitionStatus:m});const l=m==="approved";if(ee.debug("ResultsTable actions visibility",{competitionStatus:m,showActions:l}),!(t!=null&&t.length))return e.jsx("div",{className:"bg-zinc-700 p-4 rounded text-gray-400 text-center",children:"No results available"});const u=[...t].sort((d,p)=>d.placement-p.placement);return e.jsx("div",{className:"bg-zinc-700 rounded overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-white",children:"Position"}),e.jsx("th",{className:"p-3 text-white",children:"Bartender"}),e.jsx("th",{className:"p-3 text-white",children:"Source"}),e.jsx("th",{className:"p-3 text-white",children:"Status"}),l&&e.jsx("th",{className:"p-3 text-white",children:"Actions"})]})}),e.jsx("tbody",{children:u.map(d=>{var p;return e.jsxs("tr",{className:"border-t border-gray-600",children:[e.jsx("td",{className:"p-3 text-white",children:d.placement}),e.jsx("td",{className:"p-3 text-white",children:((p=d.bartenders)==null?void 0:p.full_name)||"Unknown Bartender"}),e.jsx("td",{className:"p-3 text-white",children:d.result_source?e.jsx("a",{href:d.result_source,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300",children:me(d.result_source)}):"No source"}),e.jsx("td",{className:`p-3 ${d.status==="pending"?"text-yellow-400":d.status==="approved"?"text-green-400":d.status==="rejected"?"text-red-400":d.status==="deprecated"?"text-gray-400":"text-white"}`,children:d.status||"pending"}),l&&e.jsx("td",{className:"p-3",children:d.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g==null?void 0:g(d.id,"approved"),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white",children:"Approve"}),e.jsx("button",{onClick:()=>g==null?void 0:g(d.id,"rejected"),className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white",children:"Reject"})]})})]},d.id)})})]})})},ge=({sourceCompetition:t,targetCompetitions:m,onClose:g,onMerge:l})=>{var a;const[u,d]=n.useState(null),[p,w]=n.useState({name:!1,date:!1,venue:!1,country:!1,organizer:!1,results:!0}),[h,N]=n.useState("");n.useEffect(()=>{d(null),w({name:!1,date:!1,venue:!1,country:!1,organizer:!1,results:!0}),N("")},[t==null?void 0:t.id]);const c=async()=>{if(!u)return;const r=m.find(x=>x.id===u);await l({sourceId:t.id,targetId:u,fields:p,notes:h,sourceCompetition:t,targetCompetition:r}),g()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",children:e.jsxs("div",{className:"bg-zinc-800 rounded-lg p-6 max-w-4xl w-full m-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Select Competition to Merge Into"}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-white",children:"×"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg text-white mb-2",children:"Source Competition"}),e.jsxs("div",{className:"bg-zinc-700 p-4 rounded",children:[e.jsx("div",{className:"text-white",children:t.name}),e.jsxs("div",{className:"text-gray-400",children:[new Date(t.date).toLocaleDateString()," at ",t.venue]}),((a=t.legacy_results)==null?void 0:a.length)>0&&e.jsxs("div",{className:"mt-2 text-gray-400",children:["Results: ",t.legacy_results.length," competitor(s)"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg text-white mb-2",children:"Similar Competitions"}),e.jsx("div",{className:"space-y-2",children:m==null?void 0:m.map(r=>e.jsxs("div",{onClick:()=>d(r.id),className:`p-4 rounded cursor-pointer transition-colors ${u===r.id?"bg-black":"bg-zinc-700 hover:bg-zinc-600"}`,children:[e.jsx("div",{className:"text-white",children:r.name}),e.jsxs("div",{className:"text-gray-400",children:[new Date(r.date).toLocaleDateString()," at ",r.venue]})]},r.id))})]}),u&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg text-white mb-4",children:"Fields to Merge"}),e.jsx("div",{className:"space-y-4",children:Object.entries({name:"Competition Name",date:"Date",venue:"Venue",country:"Country",organizer:"Organizer",results:"Results"}).map(([r,x])=>{var o;return e.jsxs("div",{className:"flex justify-between items-center bg-zinc-700 p-4 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium mb-1",children:x}),r!=="results"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-gray-400",children:["Source: ",t[r]||"Not set"]}),e.jsxs("div",{className:"text-gray-400",children:["Target: ",((o=m.find(b=>b.id===u))==null?void 0:o[r])||"Not set"]})]})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p[r],onChange:b=>w(f=>({...f,[r]:b.target.checked})),className:"mr-2",disabled:r==="results"}),e.jsx("span",{className:"text-white",children:"Use source value"})]})]},r)})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white mb-2",children:"Merge Notes"}),e.jsx("textarea",{value:h,onChange:r=>N(r.target.value),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",rows:3,placeholder:"Add notes about why these competitions are being merged..."})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 bg-zinc-600 text-white rounded hover:bg-zinc-700",children:"Cancel"}),e.jsx("button",{onClick:c,disabled:!u,className:"px-4 py-2 bg-black text-white rounded hover:bg-white disabled:opacity-50",children:"Merge Competitions"})]})]})})},te=R("ResultsConflictResolution"),pe=({competitionId:t,results:m=[],onResolve:g})=>{const[l,u]=n.useState([]),[d,p]=n.useState(!1),[w,h]=n.useState(null);n.useEffect(()=>{t&&N()},[t]);const N=async()=>{try{const{data:a,error:r}=await _.from("legacy_results").select(`
          id,
          bartender_id,
          placement,
          points,
          status,
          pre_competition_rating,
          post_competition_rating,
          bartenders (
            id,
            full_name,
            rating
          )
        `).eq("legacy_competition_id",t).eq("status","pending_review");if(r)throw r;if(!(a!=null&&a.length)){u([]);return}const x=a.map(s=>s.bartender_id),{data:o,error:b}=await _.from("legacy_results").select(`
          id,
          bartender_id,
          placement,
          points,
          status,
          legacy_competition_id,
          legacy_competitions!fk_lr_competition (
            id,
            name,
            date
          ),
          bartenders (
            id,
            full_name
          )
        `).in("bartender_id",x).neq("legacy_competition_id",t).eq("status","approved");if(b)throw b;const f=a.map(s=>({...s,otherResults:(o==null?void 0:o.filter(y=>y.bartender_id===s.bartender_id))||[]}));u(f)}catch(a){te.error("Error fetching conflicts:",a),h(a.message)}},c=async(a,r)=>{p(!0);try{const x=l.find(b=>b.id===a);if(!x)return;const{error:o}=await _.from("legacy_results").update({status:r==="approve"?"approved":"rejected",updated_at:new Date().toISOString()}).eq("id",a);if(o)throw o;if(r==="approve"){const b=x.otherResults.map(f=>_.from("legacy_results").update({status:"deprecated",updated_at:new Date().toISOString()}).eq("id",f.id));await Promise.all(b)}await N(),g==null||g()}catch(x){te.error("Error resolving conflict:",x),h(x.message)}finally{p(!1)}};return l.length?e.jsxs("div",{className:"mt-8 bg-zinc-800 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-xl text-white mb-4",children:"Resolve Results"}),w&&e.jsx("div",{className:"bg-red-500/20 border border-red-500 text-red-200 p-4 rounded mb-4",children:w}),e.jsx("div",{className:"space-y-4",children:l.map(a=>{var r;return e.jsx("div",{className:"bg-zinc-700 p-4 rounded",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:((r=a.bartenders)==null?void 0:r.full_name)||"Unknown Bartender"}),e.jsxs("div",{className:"mt-2 text-gray-400",children:[e.jsxs("div",{children:["Placement: ",a.placement]}),e.jsxs("div",{children:["Points: ",a.points]}),a.otherResults.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-yellow-400",children:"Existing Results:"}),a.otherResults.map(x=>{var o,b;return e.jsxs("div",{className:"ml-4 mt-1",children:[e.jsx("div",{children:(o=x.legacy_competitions)==null?void 0:o.name}),e.jsxs("div",{children:["Date: ",new Date((b=x.legacy_competitions)==null?void 0:b.date).toLocaleDateString()]}),e.jsxs("div",{children:["Placement: ",x.placement]}),e.jsxs("div",{children:["Points: ",x.points]})]},x.id)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(a.id,"approve"),disabled:d,className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"Approve"}),e.jsx("button",{onClick:()=>c(a.id,"reject"),disabled:d,className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",children:"Reject"})]})]})},a.id)})})]}):null},T=R("useCompetitionMerge"),fe=(t,m)=>{const[g,l]=n.useState(null),[u,d]=n.useState([]),[p,w]=n.useState({isOpen:!1,sourceCompetition:null,targetCompetition:null});return{selectedId:g,setSelectedId:l,similarCompetitions:u,mergeModalState:p,setMergeModalState:w,handleMergeClick:async(c,a=null)=>{var r;T.debug("Handling merge click",{sourceId:c,targetId:a});try{const{data:x,error:o}=await _.from("legacy_competitions").select(`
          *,
          legacy_results (
            id,
            bartender_id,
            placement,
            points,
            status,
            bartenders (
              id,
              full_name
            )
          )
        `).eq("id",c).single();if(o)throw o;T.debug("Fetched source competition",{id:x.id,resultsCount:(r=x.legacy_results)==null?void 0:r.length});const{data:b,error:f}=await _.from("legacy_competitions").select(`
          *,
          legacy_results (
            id,
            bartender_id,
            placement,
            points,
            status,
            bartenders (
              id,
              full_name
            )
          )
        `).neq("id",c).not("status","in",'("merged")').ilike("name",`%${x.name.split(" ").join("%")}%`);if(f)throw f;if(d(b||[]),a){const s=b==null?void 0:b.find(y=>y.id===a);s&&w({isOpen:!0,sourceCompetition:x,targetCompetition:s})}else(b==null?void 0:b.length)>0&&w({isOpen:!0,sourceCompetition:x,targetCompetition:null})}catch(x){throw T.error("Error preparing merge:",x),x}},handleMergeComplete:async c=>{T.debug("Starting merge with details:",{sourceId:c.sourceId,targetId:c.targetId});try{const{data:{user:a}}=await _.auth.getUser();if(!a)throw new Error("Authentication required");const{error:r}=await _.from("legacy_competitions").update({status:"merged",merged_into_id:c.targetId,merge_notes:c.notes,updated_by:a.id,updated_at:new Date().toISOString()}).eq("id",c.sourceId);if(r)throw r;T.info("Merge completed successfully"),await m(),l(null),w({isOpen:!1,sourceCompetition:null,targetCompetition:null})}catch(a){throw T.error("Error completing merge:",a),a}}}},B=R("Competition"),be=({competition:t,onUpdate:m,onResultStatusChange:g})=>{const[l,u]=n.useState(!1),[d,p]=n.useState(!1),[w,h]=n.useState(null),[N,c]=n.useState(!1),[a,r]=n.useState([]);B.debug("Competition component rendering",{competitionId:t.id,competitionStatus:t.status,competitionName:t.name}),fe(t,m);const x=async()=>{p(!0),h(null);try{B.debug("Checking similar competitions",{competitionId:t.id});const{data:f,error:s}=await _.from("legacy_competitions").select(`
          id, 
          name,
          date,
          venue,
          country,
          status,
          category,
          legacy_results (
            id,
            bartender_id,
            placement,
            points,
            status,
            result_source,
            competition_category
          )
        `).neq("id",t.id).not("status","in",'("merged")').ilike("name",`%${t.name.split(" ").join("%")}%`);if(s)throw s;r(f||[]),c(!0)}catch(f){B.error("Error finding similar competitions:",f),h(f.message)}finally{p(!1)}},o=async()=>{p(!0);try{const{error:f}=await _.from("legacy_competitions").update({status:"approved",updated_at:new Date().toISOString()}).eq("id",t.id);if(f)throw f;const{error:s}=await _.from("legacy_results").update({status:"pending",updated_at:new Date().toISOString()}).eq("legacy_competition_id",t.id);if(s)throw s;const{error:y}=await _.from("recalculation_queue").insert([{competition_id:t.id,queued_at:new Date().toISOString()}]).single();if(y&&!y.message.includes("duplicate"))throw y;await m()}catch(f){B.error("Error approving competition:",f),h(f.message)}finally{p(!1)}},b=async f=>{try{if(Object.values(f.fields).some(Boolean)){const y={};Object.entries(f.fields).forEach(([S,E])=>{E&&S!=="results"&&(y[S]=t[S])});const{error:C}=await _.from("legacy_competitions").update(y).eq("id",f.targetId);if(C)throw C}const{error:s}=await _.from("legacy_competitions").update({status:"merged",merged_into_id:f.targetId,merge_notes:f.notes,updated_at:new Date().toISOString()}).eq("id",t.id);if(s)throw s;c(!1),r([]),m()}catch(s){B.error("Error merging competitions:",s),h(s.message)}};return e.jsxs("div",{className:"bg-zinc-800 rounded-lg p-6 mb-6",children:[w&&e.jsx("div",{className:"bg-red-500/20 border border-red-500 text-red-200 p-4 rounded mb-4",children:w}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl text-white font-medium",children:[t.name,t.status==="pending"&&e.jsx("span",{className:"ml-2 text-yellow-400 text-sm",children:"(Pending Approval)"})]}),e.jsxs("p",{className:"text-gray-400",children:[t.date&&new Date(t.date).toLocaleDateString("en-GB")," at ",t.venue]}),t.country&&e.jsxs("p",{className:"text-gray-400",children:["Country: ",t.country]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:["Category: ",t.category?e.jsx("span",{className:"capitalize",children:t.category}):"Legacyzz"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-black text-white rounded hover:bg-white disabled:opacity-50",disabled:d,children:"Edit Details"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",disabled:d,children:d?"Processing...":"Approve Competition"}),e.jsx("button",{onClick:x,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50",disabled:d,children:"Check Similar"})]})]})]}),l&&e.jsx(xe,{competition:t,onSave:async f=>{try{const{error:s}=await _.from("legacy_competitions").update(f).eq("id",t.id);if(s)throw s;u(!1),m()}catch(s){h(s.message)}},onCancel:()=>u(!1)}),N&&(a==null?void 0:a.length)>0&&e.jsx(ge,{sourceCompetition:t,targetCompetitions:a,onClose:()=>{c(!1),r([])},onMerge:b}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-lg text-white mb-4",children:"Competition Results"}),e.jsx(he,{results:t.legacy_results,competitionStatus:t.status,onResultStatusChange:g})]}),t.status==="approved"&&e.jsx(pe,{competitionId:t.id,results:t.legacy_results,onResolve:m})]})},je=R("CompetitionFilter"),ye=({onFilter:t})=>{const[m,g]=n.useState({name:"",date:"",organizer:null}),[l,u]=n.useState(!1),d=(h,N)=>{g(c=>({...c,[h]:N}))},p=()=>{je.debug("Applying filters:",m),u(!0),t==null||t(m)},w=()=>{const h={name:"",date:"",organizer:null};g(h),u(!1),t==null||t(h)};return e.jsxs("div",{className:"bg-zinc-800 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white mb-2",children:"Competition Name"}),e.jsx("input",{type:"text",value:m.name,onChange:h=>d("name",h.target.value),placeholder:"Search by name...",className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white mb-2",children:"Date"}),e.jsx("input",{type:"date",value:m.date,onChange:h=>d("date",h.target.value),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white mb-2",children:"Organizer"}),e.jsx(le,{onSelect:h=>d("organizer",h),placeholder:"Select organizer..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[l&&e.jsx("button",{onClick:w,className:"px-4 py-2 bg-zinc-600 hover:bg-zinc-700 text-white rounded",children:"Clear Filters"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-black hover:bg-white text-white rounded",children:"Search"})]})]})},ve=R("RatingHistoryViewer"),we=({bartenderId:t,category:m="legacy",showDetails:g=!1})=>{const[l,u]=n.useState([]),[d,p]=n.useState(!0),[w,h]=n.useState(null);if(n.useEffect(()=>{t&&(async()=>{try{let{data:a,error:r}=await _.from("rating_calculations_history").select(`
              id,
              competition_id,
              calculation_time,
              effective_date,
              old_rating,
              new_rating,
              old_rd,
              new_rd,
              old_volatility,
              new_volatility,
              category
            `).eq("bartender_id",t).eq("category",m).order("effective_date",{ascending:!0});if(r)throw r;const x=a.filter(o=>o.competition_id).map(o=>o.competition_id);if(x.length>0){const{data:o,error:b}=await _.from("legacy_competitions").select("id, name, date").in("id",x);if(b)throw b;a=a.map(f=>({...f,competition:o.find(s=>s.id===f.competition_id)}))}u(a||[])}catch(a){ve.error("Error fetching history:",a),h(a.message)}finally{p(!1)}})()},[t,m]),d)return e.jsx("div",{className:"flex justify-center p-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 rounded-full animate-spin"})});if(w)return e.jsx("div",{className:"text-red-500 p-4",children:w});if(!l.length)return e.jsx("div",{className:"text-gray-400 p-4",children:"No rating history available"});const N=new Date;return N.setFullYear(N.getFullYear()-1),e.jsx("div",{className:"overflow-hidden rounded-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Competition"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Rating Change"}),g&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"RD"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Volatility"})]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:l.map(c=>{var b;const a=new Date(c.effective_date)<N,r=c.new_rating-c.old_rating,x=c.new_rd-c.old_rd,o=c.new_volatility-c.old_volatility;return e.jsxs("tr",{className:`${a?"opacity-50":""}`,children:[e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-white",children:c.effective_date?new Date(c.effective_date).toLocaleDateString():"N/A"}),g&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Calculated: ",new Date(c.calculation_time).toLocaleString()]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm text-white",children:((b=c.competition)==null?void 0:b.name)||"System Update"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:`text-sm ${r>0?"text-green-400":r<0?"text-red-400":"text-gray-400"}`,children:[r>0?"+":"",Math.round(r)]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"→"}),e.jsx("span",{className:"text-white",children:Math.round(c.new_rating)})]})}),g&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:`text-sm ${x<0?"text-green-400":x>0?"text-red-400":"text-gray-400"}`,children:[x<0?"":"+",x.toFixed(1)]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"→"}),e.jsx("span",{className:"text-white",children:c.new_rd.toFixed(1)})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:`text-sm ${o<0?"text-green-400":o>0?"text-red-400":"text-gray-400"}`,children:[o<0?"":"+",o.toFixed(3)]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"→"}),e.jsx("span",{className:"text-white",children:c.new_volatility.toFixed(3)})]})})]})]},c.id)})})]})})})},U=R("ResultsManagementTab"),se=()=>{const[t,m]=n.useState([]),[g,l]=n.useState(!0),[u,d]=n.useState(null),[p,w]=n.useState({});n.useState(null);const h=async()=>{var c;try{l(!0),d(null);let a=_.from("legacy_competitions").select(`
          id,
          name,
          date,
          venue,
          country,
          status,
          category,
          created_at,
          updated_at,
          created_by,
          updated_by,
          organizer
        `).not("status","eq","merged").order("date",{ascending:!1});if(p.name&&(a=a.ilike("name",`%${p.name}%`)),p.date){const y=new Date(p.date).toISOString().split("T")[0];a=a.eq("date",y)}(c=p.organizer)!=null&&c.id&&(a=a.eq("organizer",p.organizer.id));const{data:r,error:x}=await a;if(x)throw x;const o=r.map(y=>y.id);if(o.length===0){m([]);return}const{data:b,error:f}=await _.from("legacy_results").select(`
          id,
          legacy_competition_id,
          bartender_id,
          placement,
          points,
          status,
          result_source,
          pre_competition_rating,
          post_competition_rating,
          competition_category,
          pre_competition_rd,
          post_competition_rd,
          pre_competition_volatility,
          post_competition_volatility,
          bartenders (
            id,
            full_name
          )
        `).in("legacy_competition_id",o);if(f)throw f;const s=await Promise.all(r.map(async y=>{const C=b.filter(E=>E.legacy_competition_id===y.id),S=await Promise.all(C.map(async E=>{const{data:A}=await _.from("rating_calculations_history").select("*").eq("competition_id",y.id).eq("bartender_id",E.bartender_id).eq("category",E.competition_category||"legacy").single();return{...E,rating_history:A}}));return{...y,legacy_results:S}}));m(s)}catch(a){U.error("Error fetching competitions:",a),d(a.message)}finally{l(!1)}};n.useEffect(()=>{h()},[p]);const N=async(c,a)=>{try{const x={approved:"approved",rejected:"deprecated",pending:"pending",pending_review:"pending_review",deprecated:"deprecated"}[a]||a;U.debug("Updating result status",{resultId:c,newStatus:a,mappedStatus:x});const{error:o}=await _.from("legacy_results").update({status:x,updated_at:new Date().toISOString()}).eq("id",c);if(o)throw o;await h(),U.debug("Result status updated successfully")}catch(r){U.error("Error updating result status:",r),d(`Failed to update result status: ${r.message}`)}};return g?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Competition Results Management"}),e.jsx(ye,{onFilter:w}),u&&e.jsx("div",{className:"bg-red-500/20 border border-red-500 text-red-200 p-4 rounded mb-6",children:u}),e.jsxs("div",{className:"space-y-6",children:[t.map(c=>e.jsx(be,{competition:c,onUpdate:h,onResultStatusChange:N},c.id)),t.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8",children:"No competitions found"})]})]})},J=G("AdminTable"),ae=({sources:t})=>t!=null&&t.length?e.jsx("div",{className:"space-y-1",children:t.map((m,g)=>e.jsx("a",{href:m.url,target:"_blank",rel:"noopener noreferrer",className:"block text-blue-400 hover:text-blue-300 truncate",children:m.url},g))}):e.jsx("span",{className:"text-gray-400",children:"No sources"}),Ne=({tableName:t,showApproveButtons:m=!1,defaultFilters:g={}})=>{const[l,u]=n.useState([]),[d,p]=n.useState(!0),[w,h]=n.useState(null),[N,c]=n.useState(null),[a,r]=n.useState({}),[x,o]=n.useState(g),[b,f]=n.useState({key:"created_at",direction:"desc"}),[s,y]=n.useState({});n.useEffect(()=>{C();const j=S();return()=>j==null?void 0:j.unsubscribe()},[t]);const C=async()=>{try{p(!0);let j=I.from(t).select("*");t==="legacy_competitions"?j=I.from(t).select(`
          *,
          sources (
            id,
            url,
            created_at
          )
        `):t==="legacy_results"&&(j=I.from(t).select(`
          *,
          legacy_competition:legacy_competition_id (
            id,
            name,
            sources (
              id,
              url,
              created_at
            )
          )
        `));const{data:v,error:k}=await j;if(k)throw k;const D={};v&&v.forEach($=>{var M;$.sources?D[$.id]=$.sources:(M=$.legacy_competition)!=null&&M.sources&&(D[$.id]=$.legacy_competition.sources)}),y(D),u(v||[]),h(null)}catch(j){J.error("Error loading data",j),h(j.message),u([])}finally{p(!1)}},S=()=>I.channel(`${t}_changes`).on("postgres_changes",{event:"*",schema:"public",table:t},()=>C()).subscribe(),E=async j=>{try{const v={...a};delete v.id,delete v.created_at,delete v.updated_at,delete v.sources;const{error:k}=await I.from(t).update(v).eq("id",j);if(k)throw k;await C(),c(null),r({})}catch(v){J.error("Error saving row",v),h(v.message)}},A=async(j,v)=>{try{const{error:k}=await I.from(t).update({status:v}).eq("id",j);if(k)throw k;await C()}catch(k){J.error("Error updating status",k),h(k.message)}},O=n.useMemo(()=>l!=null&&l.length?l.filter(j=>Object.keys(x).every(v=>{if(!x[v])return!0;const k=j[v];return k==null?!1:String(k).toLowerCase().includes(String(x[v]).toLowerCase())})).sort((j,v)=>{if(!b.key)return 0;const k=j[b.key],D=v[b.key];return k===null?1:D===null?-1:b.direction==="asc"?k>D?1:-1:k<D?1:-1}):[],[l,x,b]),V=j=>new Date(j).toLocaleString(),W=(j,v)=>N===j.id?v==="sources"?e.jsx(ae,{sources:s[j.id]}):v==="created_at"||v==="updated_at"?V(j[v]):e.jsx("input",{type:"text",value:a[v]||"",onChange:k=>r(D=>({...D,[v]:k.target.value})),className:"w-full bg-zinc-700 text-white px-2 py-1 rounded"}):v==="sources"?e.jsx(ae,{sources:s[j.id]}):v==="created_at"||v==="updated_at"?V(j[v]):K.isValidElement(j[v])?j[v]:String(j[v]||"");if(d)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})});if(!l.length)return e.jsx("div",{className:"text-center p-8 text-gray-400",children:"No data available"});const H=[...Object.keys(l[0]),"sources"];return e.jsxs("div",{children:[w&&e.jsx("div",{className:"bg-red-900/50 border border-red-500 text-white p-4 rounded-lg mb-6",children:w}),e.jsx("div",{className:"bg-zinc-800 rounded-lg shadow-xl",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[H.map(j=>e.jsxs("th",{className:"p-4 text-left",children:[e.jsxs("button",{onClick:()=>f({key:j,direction:b.key===j&&b.direction==="asc"?"desc":"asc"}),className:"flex items-center gap-2 hover:text-blue-400 transition-colors",children:[e.jsx("span",{className:"capitalize",children:j.replace(/_/g," ")}),e.jsx("span",{className:"text-sm opacity-50",children:b.key===j?b.direction==="asc"?"↑":"↓":"↕"})]}),e.jsx("input",{type:"text",placeholder:`Filter ${j}...`,value:x[j]||"",onChange:v=>o(k=>({...k,[j]:v.target.value})),className:"w-full bg-zinc-700 text-white px-2 py-1.5 rounded text-sm border border-gray-600 mt-2"})]},j)),e.jsx("th",{className:"p-4 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:O.map(j=>e.jsxs("tr",{className:"border-t border-gray-700",children:[H.map(v=>e.jsx("td",{className:"p-4",children:W(j,v)},v)),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex gap-2",children:N===j.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(j.id),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white",children:"Save"}),e.jsx("button",{onClick:()=>{c(null),r({})},className:"bg-zinc-600 hover:bg-zinc-700 px-3 py-1 rounded text-white",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{c(j.id),r(j)},className:"bg-black hover:bg-white px-3 py-1 rounded text-white",children:"Edit"}),m&&j.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>A(j.id,"approved"),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white",children:"Approve"}),e.jsx("button",{onClick:()=>A(j.id,"denied"),className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white",children:"Deny"})]})]})})})]},j.id))})]})})})]})},_e=()=>e.jsx(Ne,{tableName:"organisers"}),Y=R("ProfileClaimsTab"),re=({value:t,onChange:m,disabled:g=!1})=>e.jsx("input",{type:"text",value:t||"",onChange:l=>m(l.target.value),disabled:g,className:"w-full bg-zinc-700 text-white focus:outline-none focus:ring-1 focus:ring-blue-500 p-2 rounded disabled:opacity-50"}),Se=()=>{const[t,m]=n.useState([]),[g,l]=n.useState(!0),[u,d]=n.useState(null),[p,w]=n.useState(null),[h,N]=n.useState({}),[c,a]=n.useState({});n.useEffect(()=>{r()},[]);const r=async()=>{try{l(!0);const{data:s,error:y}=await _.from("bartenders").select("*").not("users_attempting_to_claim","eq","{}").not("users_attempting_to_claim","is",null);if(y)throw y;const C=[];for(const S of s||[])if(Array.isArray(S.users_attempting_to_claim)&&S.users_attempting_to_claim.length>0){for(const E of S.users_attempting_to_claim)if(E)try{const{data:A}=await _.from("bartenders").select("*").eq("user_id",E).maybeSingle();A&&C.push({targetProfile:S,claimantProfile:A,submission:{id:`${S.id}-${E}`,user_id:E}})}catch(A){Y.error(`Error processing claim for user ${E}:`,A)}}m(C),d(null)}catch(s){Y.error("Error fetching claims:",s),d(s.message)}finally{l(!1)}},x=async()=>{try{const s=h,y=c,{error:C}=await _.from("bartenders").update({user_id:s.user_id,is_profile_claimed:!0,is_approved:!0,users_attempting_to_claim:[],updated_at:new Date().toISOString()}).eq("id",y.id);if(C)throw C;const{error:S}=await _.from("bartenders").update({is_archived:!0,user_id:null,users_attempting_to_claim:[],updated_at:new Date().toISOString()}).eq("id",s.id);if(S)throw S;await r(),w(null),N({}),a({})}catch(s){Y.error("Error accepting claim:",s),d(s.message)}},o=async()=>{try{const s=c,y=h.user_id;if(!s.users_attempting_to_claim)throw new Error("Invalid claim data");const C=s.users_attempting_to_claim.filter(E=>E!==y),{error:S}=await _.from("bartenders").update({users_attempting_to_claim:C,updated_at:new Date().toISOString()}).eq("id",s.id);if(S)throw S;await r(),w(null),N({}),a({})}catch(s){Y.error("Error denying claim:",s),d(s.message)}},b=s=>{a(y=>({...y,[s]:h[s]}))},f=(s,y)=>p?e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsx("div",{className:"flex-1 bg-zinc-800 p-2 rounded",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(re,{value:h[s],onChange:C=>N(S=>({...S,[s]:C}))}),e.jsx("button",{onClick:()=>b(s),className:"text-blue-400 hover:text-blue-300 ml-2 px-2",title:"Copy to right",children:"→"})]})}),e.jsx("div",{className:"text-gray-400 w-24 text-center text-sm",children:y}),e.jsx("div",{className:"flex-1 bg-zinc-800 p-2 rounded",children:e.jsx(re,{value:c[s],onChange:C=>a(S=>({...S,[s]:C}))})})]}):null;return g?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})}):u?e.jsx("div",{className:"p-4 bg-red-900/50 border border-red-500 text-red-200 rounded",children:u}):e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-2xl mb-6",children:"Profile Claims"}),p?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{w(null),N({}),a({})},className:"mb-4 text-gray-400 hover:text-gray-300 flex items-center gap-2",children:[e.jsx("span",{children:"←"})," Back to claims"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl mb-4",children:"Compare Profiles"}),f("full_name","Name"),f("bar","Bar"),e.jsxs("div",{className:"flex gap-4 mt-8",children:[e.jsx("button",{onClick:o,className:"flex-1 bg-red-600 px-6 py-2 rounded hover:bg-red-700 text-white",children:"Deny Claim"}),e.jsx("button",{onClick:x,className:"flex-1 bg-green-600 px-6 py-2 rounded hover:bg-green-700 text-white",children:"Accept Claim"})]})]})]}):e.jsx("div",{className:"grid gap-4",children:t.length===0?e.jsx("div",{className:"text-gray-400 text-center p-4",children:"No pending profile claims"}):t.map(s=>e.jsxs("div",{className:"bg-zinc-800 p-4 rounded",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-white",children:"Claimant: "}),e.jsx("span",{className:"text-gray-300",children:s.claimantProfile.full_name})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-white",children:"Target: "}),e.jsx("span",{className:"text-gray-300",children:s.targetProfile.full_name})]})]}),e.jsx("button",{onClick:()=>{w(s),N(s.claimantProfile),a(s.targetProfile)},className:"bg-black px-4 py-2 rounded hover:bg-white text-white",children:"Review"})]},s.submission.id))})]})},Ce=()=>{const[t,m]=n.useState("legacy"),[g,l]=n.useState(!1),[u,d]=n.useState(""),[p,w]=n.useState(null),[h,N]=n.useState([]),[c,a]=n.useState(!0),r=[{id:"legacy",label:"Legacy"},{id:"speed",label:"Speed"},{id:"traditional",label:"Traditional"},{id:"flair",label:"Flair"}],x={legacy:["rating","rating_rd","rating_volatility","ranking"],speed:["speed_rating","speed_rd","speed_volatility","speed_ranking"],traditional:["traditional_rating","traditional_rd","traditional_volatility","traditional_ranking"],flair:["flair_rating","flair_rd","flair_volatility","flair_ranking"]};K.useEffect(()=>{o()},[t]);const o=async()=>{try{const s=x[t],{data:y,error:C}=await _.from("bartenders").select(`
          id,
          full_name,
          ${s.join(",")}
        `).not("is_archived","eq",!0).order(s[3],{ascending:!0,nullsLast:!0});if(C)throw C;N(y||[])}catch(s){d(`Error fetching data: ${s.message}`)}finally{a(!1)}},b=async s=>{l(!0),d(`Resetting ${s} ratings...`);try{const{error:y}=await _.rpc("reset_and_recalculate_category_ratings",{p_category:s,p_process_immediately:!0,p_log_details:!1});if(y)throw y;d(`${s} ratings reset and recalculated successfully`),await o()}catch(y){d(`Error: ${y.message}`)}finally{l(!1)}},f=(s,y)=>{const C=t==="legacy"?"":`${t}_`;return s[`${C}${y}`]||0};return c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex gap-2",children:r.map(s=>e.jsx("button",{onClick:()=>m(s.id),className:`px-4 py-2 rounded-lg ${t===s.id?"bg-black text-white":"bg-zinc-700 text-gray-300 hover:bg-zinc-600"}`,children:s.label},s.id))}),e.jsx("button",{onClick:()=>b(t),disabled:g,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:"Reset & Recalculate"})]}),u&&e.jsx("div",{className:`p-4 rounded-lg ${u.includes("Error")?"bg-red-900/50 text-red-200":"bg-green-900/50 text-green-200"}`,children:u}),e.jsx("div",{className:"bg-zinc-800 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Rank"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Rating"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"RD"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Volatility"}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:h.map(s=>e.jsxs(K.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:f(s,"ranking")||"Unranked"}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:s.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:Math.round(f(s,"rating"))}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:f(s,"rd").toFixed(1)}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:f(s,"volatility").toFixed(3)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>w(p===s.id?null:s.id),className:"text-blue-400 hover:text-blue-300",children:p===s.id?"Hide":"History"})})]}),p===s.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-4 bg-gradient-to-b from-zinc-800 to-zinc-900",children:e.jsx(we,{bartenderId:s.id,category:t,showDetails:!0})})})]},s.id))})]})})})]})},ke=()=>{const[t,m]=n.useState("results");n.useEffect(()=>{const l=()=>{const u=window.location.hash.slice(1);u&&m(u.toLowerCase())};return l(),window.addEventListener("hashchange",l),()=>window.removeEventListener("hashchange",l)},[]);const g=()=>{switch(t){case"results":return e.jsx(se,{});case"bartenders":return e.jsx(ue,{});case"organisers":return e.jsx(_e,{});case"profile_claims":return e.jsx(Se,{});case"glicko_ratings":return e.jsx(Ce,{});default:return e.jsx(se,{})}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-zinc-800 to-zinc-900 text-white p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Admin Dashboard"}),e.jsx(de,{activeTab:t,onTabChange:m}),g()]})})},Ee=G("AdminPage"),$e=()=>(n.useEffect(()=>{Ee.info("AdminPage mounted (protected)")},[]),e.jsx(ke,{}));export{$e as default};
