import{s as d,g as m,l as y,d as b,i as S,b as E}from"./countdown-BD2dHnwk.js";async function q(){const t=document.querySelectorAll(".auth-tab"),e=document.querySelectorAll(".auth-form"),o=await b.getCurrentUser();if(o){g(o);return}if(t.length>0&&e.length>0){t.forEach(r=>{r.addEventListener("click",()=>{var i;const n=r.dataset.form;t.forEach(a=>a.classList.remove("active")),e.forEach(a=>a.classList.remove("active")),r.classList.add("active"),(i=document.getElementById(`${n}-form`))==null||i.classList.add("active")})});const c=document.getElementById("signin-form"),s=document.getElementById("signup-form");if(c&&c.addEventListener("submit",w),s){s.addEventListener("submit",L);const r=s.querySelector('select[name="role"]'),n=s.querySelector(".bartender-fields"),i=s.querySelector(".organiser-fields");r&&n&&i&&r.addEventListener("change",a=>{n.style.display=a.target.value==="bartender"?"block":"none",i.style.display=a.target.value==="organiser"?"block":"none"})}}}async function w(t){t.preventDefault();const e=t.target,o=e.querySelector('input[type="email"]').value,c=e.querySelector('input[type="password"]').value,s=v(e),r=h(e);s.style.display="none",r.style.display="none";try{const{data:n,error:i}=await d.auth.signInWithPassword({email:o,password:c});if(i)throw i;if(n.user){r.textContent="Login successful! Redirecting...",r.style.display="block",g(n.user);const a=m();setTimeout(()=>window.location.href=a,1500)}}catch(n){y(n),s.textContent=n.message||"Error signing in",s.style.display="block"}}async function L(t){t.preventDefault();const e=t.target,o=e.querySelector('input[name="fullName"]').value,c=e.querySelector('input[name="email"]').value,s=e.querySelector('input[name="password"]').value,r=e.querySelector('select[name="role"]').value,n=r==="bartender"?e.querySelector('input[name="bar"]').value:null,i=r==="organiser"?e.querySelector('input[name="brand"]').value:null,a=v(e),u=h(e);a.style.display="none",u.style.display="none";try{const{data:l,error:f}=await d.auth.signUp({email:c,password:s,options:{data:{full_name:o,role:r,bar:n,brand:i}}});if(f)throw f;if(l.user){u.textContent="Account created successfully! Please check your email for verification.",u.style.display="block";const p=m();setTimeout(()=>window.location.href=p,3e3)}}catch(l){y(l),a.textContent=l.message||"Error creating account",a.style.display="block"}}function g(t){const e=document.querySelector(".auth-container");e&&(e.innerHTML=`
      <div class="profile-summary">
        <h2>Welcome, ${t.user_metadata.full_name||"User"}</h2>
        <button onclick="handleSignOut()" class="submit-button">Sign Out</button>
      </div>
    `)}function v(t){let e=t.querySelector(".error-message");return e||(e=document.createElement("div"),e.className="error-message",t.insertBefore(e,t.firstChild)),e}function h(t){let e=t.querySelector(".success-message");return e||(e=document.createElement("div"),e.className="success-message",t.insertBefore(e,t.firstChild)),e}window.handleSignOut=async function(){try{const{error:t}=await d.auth.signOut();if(t)throw t;const e=m();window.location.href=e+"enter"}catch(t){y(t),alert("Error signing out. Please try again.")}};document.addEventListener("DOMContentLoaded",()=>{S(),E(),q()});function k(){const t=document.querySelectorAll(".auth-tab"),e=document.querySelectorAll(".auth-form"),o=document.querySelector('select[name="role"]'),c=document.querySelector(".bartender-fields"),s=document.querySelector(".organiser-fields");t.forEach(r=>{r.addEventListener("click",()=>{t.forEach(n=>n.classList.remove("active")),e.forEach(n=>n.classList.remove("active")),r.classList.add("active"),document.getElementById(`${r.dataset.form}-form`).classList.add("active")})}),o==null||o.addEventListener("change",r=>{r.target.value==="bartender"?(c.style.display="block",s.style.display="none"):(c.style.display="none",s.style.display="block")})}k();
