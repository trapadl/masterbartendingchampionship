import{j as e,r as n,s as Z,c as X,u as re,a as ie,b as ne}from"./main-D1s2dzev.js";import{s as S,l as oe,c as ee,O as le,a as ce,b as V}from"./toast-BIDwJeh5.js";import{E as de}from"./EventCarousel-BEOFpSmK.js";class me{async retryQuery(f,l,b=2){for(let d=1;d<=b;d++)try{console.log(`[LeaderboardService] ${l} attempt ${d}/${b}`);const i=await f();return console.log(`[LeaderboardService] ${l} succeeded on attempt ${d}`),i}catch(i){if(console.warn(`[LeaderboardService] ${l} failed on attempt ${d}:`,i.message),d===b)throw i;const c=d===1?500:1e3;console.log(`[LeaderboardService] Retrying ${l} in ${c}ms...`),await new Promise(y=>setTimeout(y,c))}}async fetchLeaderboardData(){const f=Date.now();console.log(`[LeaderboardService] Starting fetchLeaderboardData at ${new Date().toISOString()}`);const l=Date.now()-performance.timeOrigin;document.readyState==="complete"&&l<1e3&&(console.log(`[LeaderboardService] Detected recent page load (${l}ms ago), adding minimal delay`),await new Promise(b=>setTimeout(b,50)));try{console.log(`[LeaderboardService] Starting database queries at ${Date.now()-f}ms`);try{const{data:t}=await S.auth.getSession();console.log(`[LeaderboardService] Session status: ${t.session?"authenticated":"anonymous"}`)}catch{console.warn("[LeaderboardService] Session check failed, proceeding with anonymous access")}const b=new Promise((t,a)=>setTimeout(()=>a(new Error(`Database query timeout after 8s - elapsed: ${Date.now()-f}ms`)),8e3));console.log(`[LeaderboardService] Starting parallel database queries at ${Date.now()-f}ms`);const[d,i]=await Promise.all([this.retryQuery(async()=>{const t=S.from("legacy_results").select(`
              id,
              legacy_competition_id,
              bartender_id,
              placement,
              points,
              status,
              competition_category,
              legacy_competitions (
                id,
                name,
                date,
                category
              )
            `).eq("status","approved");return await Promise.race([t,b])},"legacy_results query"),this.retryQuery(async()=>{const t=S.from("bartenders").select(`
              id, 
              full_name,
              rating,
              rating_rd,
              rating_volatility,
              ranking,
              speed_rating,
              speed_rd,
              speed_volatility,
              speed_ranking,
              traditional_rating,
              traditional_rd,
              traditional_volatility,
              traditional_ranking,
              flair_rating,
              flair_rd,
              flair_volatility,
              flair_ranking
            `).eq("is_approved",!0).not("is_archived","eq",!0);return await Promise.race([t,b])},"bartenders query")]),{data:c,error:y}=d,{data:w,error:x}=i;if(console.log(`[LeaderboardService] Parallel queries completed at ${Date.now()-f}ms - results: ${(c==null?void 0:c.length)||0}, bartenders: ${(w==null?void 0:w.length)||0}`),y)throw y;if(x)throw x;const r={legacy:new Set,speed:new Set,traditional:new Set,flair:new Set};return c.forEach(t=>{var u;if(!t.bartender_id)return;let a=t.competition_category||"legacy";!t.competition_category&&((u=t.legacy_competitions)!=null&&u.category)&&(a=t.legacy_competitions.category),r[a]?r[a].add(t.bartender_id):r.legacy.add(t.bartender_id)}),{legacy:w.filter(t=>r.legacy.has(t.id)&&t.rating!=null).sort((t,a)=>(a.rating||0)-(t.rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.rating,rating_rd:t.rating_rd,points:Math.round(t.rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),speed:w.filter(t=>r.speed.has(t.id)&&t.speed_rating!=null).sort((t,a)=>(a.speed_rating||0)-(t.speed_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.speed_rating,rating_rd:t.speed_rd,points:Math.round(t.speed_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),traditional:w.filter(t=>r.traditional.has(t.id)&&t.traditional_rating!=null).sort((t,a)=>(a.traditional_rating||0)-(t.traditional_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.traditional_rating,rating_rd:t.traditional_rd,points:Math.round(t.traditional_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'})),flair:w.filter(t=>r.flair.has(t.id)&&t.flair_rating!=null).sort((t,a)=>(a.flair_rating||0)-(t.flair_rating||0)).map(t=>({id:t.id,name:t.full_name,rating:t.flair_rating,rating_rd:t.flair_rd,points:Math.round(t.flair_rating||0),img:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>'}))}}catch(b){return oe(b),{legacy:[],traditional:[],flair:[],speed:[]}}}}const ue=new me,ge=e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"7",r:"4"}),e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),W=10;function he({data:g=[],type:f="legacy",filter:l="rating",currentPage:b=0,onPageChange:d,searchActive:i=!1,onHistoryClick:c=()=>{}}){const y=m=>Math.round(m.rating||0),w="Rating",x=i?0:b*W,r=i?g.slice(0,Math.min(50,g.length)):g.slice(x,x+W),t=i?1:Math.ceil(g.length/W),a=b<t-1,u=b>0,N=m=>m%2===0?"bg-zinc-850":"bg-zinc-800";return e.jsxs("div",{className:"overflow-x-auto rounded-lg shadow",children:[e.jsxs("table",{className:"leaderboard-table min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-zinc-700",children:e.jsx("tr",{children:["Rank","Profile","Name",w].map(m=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:m},m))})}),e.jsxs("tbody",{className:"divide-y divide-gray-700",children:[r.map((m,s)=>e.jsxs("tr",{className:`${N(s)} hover:bg-zinc-700 cursor-pointer`,onClick:()=>c(m),children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:i?s+1:x+s+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"profile-pic h-10 w-10 bg-zinc-600 rounded-full flex items-center justify-center border border-gray-500 hover:border-white transition-colors",onClick:h=>{h.stopPropagation(),c(m)},title:`History for ${m.name}`,children:ge})}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:m.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-white font-medium",children:y(m)})]},m.id||s)),!i&&(a||u)&&e.jsx("tr",{className:"pagination-row bg-zinc-800",children:e.jsx("td",{colSpan:"4",className:"text-center py-3 px-4 border-t border-gray-700",children:e.jsxs("div",{className:"pagination-controls flex justify-center gap-3",children:[u&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"pagination-button",onClick:()=>d(0),children:"Top 10"}),e.jsx("button",{className:"pagination-button",onClick:()=>d(b-1),children:"Previous 10"})]}),a&&e.jsx("button",{className:"pagination-button",onClick:()=>d(b+1),children:"Next 10"})]})})}),i&&g.length>50&&e.jsx("tr",{className:"bg-zinc-800",children:e.jsx("td",{colSpan:"4",className:"text-center py-3 px-4 text-gray-400 border-t border-gray-700",children:"Showing top 50 results. Please refine your search."})})]})]}),g.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 italic",children:i?"No bartenders match your search.":"No competitors found yet."}),!i&&g.length>0&&r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 italic",children:"No more results on this page."})]})}const K=({isOpen:g,onClose:f,title:l,children:b,maxWidth:d="max-w-xl"})=>{if(n.useEffect(()=>{const c=y=>{y.key==="Escape"&&f()};return g?(document.addEventListener("keydown",c),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.removeEventListener("keydown",c),document.body.style.overflow=""}},[g,f]),!g)return null;const i=c=>{c.target===c.currentTarget&&f()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 transition-opacity duration-300 ease-in-out",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`bg-zinc-800 rounded-lg shadow-xl w-full ${d} max-h-[90vh] overflow-hidden flex flex-col`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-700 flex-shrink-0",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-white",children:l||"Modal"}),e.jsx("button",{type:"button",onClick:f,className:"text-gray-400 hover:text-white text-2xl leading-none font-bold focus:outline-none p-1","aria-label":"Close modal",children:"×"})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-grow",children:b})]})})},Q=X("CompetitionHistoryModalContent"),pe=({bartenderId:g,bartenderName:f})=>{const[l,b]=n.useState([]),[d,i]=n.useState(!0),[c,y]=n.useState(null);n.useEffect(()=>{(async()=>{if(!g){i(!1),y("Bartender ID is missing.");return}i(!0),y(null),Q.debug(`Fetching history for bartender ID: ${g}`);try{const{data:r,error:t}=await Z.from("legacy_results").select(`placement,
             post_competition_rating,
             pre_competition_rating,
             legacy_competition_id,
             legacy_competitions (
               id,
               name,
               date
             )`).eq("bartender_id",g).order("date",{ascending:!1,foreignTable:"legacy_competitions"});if(t)throw t;Q.debug("Fetched competition history",{bartenderId:g,resultCount:r==null?void 0:r.length}),b(r||[])}catch(r){Q.error("Error fetching competition history:",{bartenderId:g,error:r}),y(`Failed to load competition history: ${r.message}. Please try again.`)}finally{i(!1)}})()},[g]);const w=(x,r)=>x==null||r==null?"?":Math.round(r-x);return e.jsx("div",{className:"competition-history-content max-h-[70vh] overflow-y-auto pr-2",children:d?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx("div",{className:"animate-spin h-6 w-6 border-4 border-white rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-3 text-gray-300",children:"Loading history..."})]}):c?e.jsx("div",{className:"text-red-400 p-4 text-center bg-black/50 rounded border border-red-500",children:c}):l.length===0?e.jsxs("div",{className:"text-gray-400 p-6 text-center italic",children:["No competition history found for ",f,"."]}):e.jsxs("table",{className:"competition-history-table min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Competition"}),e.jsx("th",{className:"text-center",children:"Placement"}),e.jsx("th",{className:"text-center",children:"Rating Change"})]})}),e.jsx("tbody",{children:l.map((x,r)=>{var m,s,h;const t=w(x.pre_competition_rating,x.post_competition_rating),a=(m=x.legacy_competitions)!=null&&m.date?new Date(x.legacy_competitions.date).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"}):"Unknown Date",u=t==="?"?"text-gray-400":t>0?"text-white":"text-gray-400",N=(s=x.legacy_competitions)!=null&&s.id?`${x.legacy_competitions.id}-${r}`:r;return e.jsxs("tr",{className:"even:bg-zinc-800 odd:bg-gradient-to-b from-zinc-800 to-zinc-900",children:[e.jsx("td",{className:"text-sm text-gray-300 whitespace-nowrap",children:a}),e.jsx("td",{className:"text-sm text-white",children:((h=x.legacy_competitions)==null?void 0:h.name)||"Unknown Competition"}),e.jsx("td",{className:"text-sm text-center text-gray-300",children:x.placement||"N/A"}),e.jsx("td",{className:`text-sm text-center font-medium ${u}`,children:t>=0?`+${t}`:t})]},N)})})]})})};function H({id:g,title:f,type:l,data:b=[],page:d,filter:i,onPageChange:c,onFilterChange:y,showFilters:w=!1,showClaimButton:x=!1,hasPendingClaim:r=!1,comingSoon:t=!1,onClaimProfileClick:a,onSubmitResultClick:u}){const[N,m]=n.useState(""),[s,h]=n.useState(!1),[v,_]=n.useState(null),E=N.trim()?b.filter(k=>k.name.toLowerCase().includes(N.toLowerCase())):b,M=10,z=d*M,R=E.slice(z,z+M),F=k=>{_(k),h(!0)},o=()=>{_(null),h(!1)},j=k=>{m(k.target.value),d!==0&&c(l,0)},L=()=>m(""),C="px-4 py-2 rounded border transition-colors duration-200",D=`${C} bg-white text-black border-white hover:bg-zinc-200 hover:border-gray-200`,P=`${C} bg-transparent text-white border-gray-500 hover:bg-zinc-700`,O=`${C} bg-white text-black border-white`;return e.jsxs("div",{id:g,className:`leaderboard-container ${t?"coming-soon":""} mb-12`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-white",children:f}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"search-container mb-4",children:[e.jsxs("div",{className:"relative w-full sm:w-1/4",children:[e.jsx("input",{type:"text",placeholder:"// search...",value:N,onChange:j,className:"w-full p-2 pl-10 bg-zinc-700 text-white rounded border border-gray-600 focus:border-gray-500 focus:outline-none"}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:`M8 4a4 4 0 100 8 4 4 0 000-8zM2 \r
                       8a6 6 0 1110.89 3.476l4.817\r
                       4.817a1 1 0 01-1.414 \r
                       1.414l-4.816-4.816A6 6 0 012 8z`,clipRule:"evenodd"})})}),N&&e.jsx("button",{className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white",onClick:L,children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:`M10 18a8 8 0 100-16 8 8 0 000 \r
                         16zM8.707 7.293a1 1 0 00-1.414 \r
                         1.414L8.586 10l-1.293 1.293a1 1 \r
                         0 101.414 1.414L10 11.414l1.293 \r
                         1.293a1 1 0 001.414-1.414L11.414 \r
                         10l1.293-1.293a1 1 0 00-1.414-1.414L10 \r
                         8.586 8.707 7.293z`,clipRule:"evenodd"})})})]}),N&&E.length===0?e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["No results for “",N,"”"]}):N?e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["Found ",E.length," ",E.length===1?"result":"results"]}):null]}),e.jsxs("div",{className:"button-container flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[w&&e.jsx("div",{className:"filter-buttons flex gap-2",children:e.jsx("button",{className:i==="rating"?O:P,onClick:()=>y(l,"rating"),children:"Rating"})}),l==="legacy"&&e.jsxs("div",{className:"action-buttons flex gap-2",children:[x&&a&&(r?e.jsx("button",{className:`${D} bg-zinc-600 text-gray-400 border-gray-600 cursor-not-allowed opacity-70`,disabled:!0,children:"Claim Pending"}):e.jsx("button",{className:D,onClick:a,children:"Claim Profile"})),u&&e.jsx("button",{className:D,onClick:u,children:"Submit Result"})]})]})]}),e.jsxs("div",{className:"leaderboard-content",children:[e.jsx(he,{data:E,type:l,filter:i,currentPage:d,onPageChange:k=>c(l,k),searchActive:!!N.trim(),onHistoryClick:F}),e.jsxs("div",{className:"record-cards",children:[R.map((k,p)=>e.jsxs("div",{className:"record-card",onClick:()=>F(k),role:"button",tabIndex:0,onKeyPress:$=>$.key==="Enter"&&F(k),children:[e.jsx("div",{className:"rank",children:z+p+1}),e.jsx("div",{className:"pic",children:e.jsx("div",{className:"profile-pic",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:`M5.121 17.804A9.969 9.969 0 \r
                         0112 15c2.387 0 4.58.834 6.364 \r
                         2.197M15 7a3 3 0 11-6 \r
                         0 3 3 0 016 0z`})})})}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"name",children:k.name}),e.jsx("div",{className:"rating",children:Math.round(k.rating||0)})]})]},k.id||p)),e.jsxs("div",{className:"pagination-row",children:[z>0&&e.jsx("button",{className:"pagination-button",onClick:()=>c(l,d-1),children:"Previous 10"}),z+M<E.length&&e.jsx("button",{className:"pagination-button",onClick:()=>c(l,d+1),children:"Next 10"})]})]})]}),e.jsx(K,{isOpen:s,onClose:o,title:`${(v==null?void 0:v.name)||"Bartender"}'s Competition History`,maxWidth:"max-w-4xl",children:v&&e.jsx(pe,{bartenderId:v.id,bartenderName:v.name})})]})}const Y=ee("BartenderSelect"),ae=({value:g,onSelect:f,placeholder:l="Select a bartender",initialLabel:b="",excludeIds:d=[]})=>{const[i,c]=n.useState(b),[y,w]=n.useState(!1),[x,r]=n.useState([]),[t,a]=n.useState(!1),[u,N]=n.useState(null);n.useEffect(()=>{if(!i.trim()){r([]);return}const v=setTimeout(async()=>{a(!0);try{let _=S.from("bartenders").select("id, full_name, is_approved").ilike("full_name",`%${i}%`).is("is_archived",!1);d.length>0&&(_=_.not("id","in",`(${d.join(",")})`));const{data:E,error:M}=await _.limit(5);if(M)throw M;r(E||[])}catch(_){Y.error("Failed to load bartenders:",_),N("Failed to load bartenders")}finally{a(!1)}},300);return()=>clearTimeout(v)},[i,d.join(",")]);const m=h=>{c(h.full_name),w(!1),f(h)},s=async()=>{try{const{data:{user:h}}=await S.auth.getUser();if(!h)throw new Error("Please sign in to add a new bartender");const{data:v,error:_}=await S.from("bartenders").insert({full_name:i.trim(),bar:"",rating:1500,rating_rd:350,rating_volatility:.06,is_profile_claimed:!1,is_approved:!1}).select().single();if(_)throw _;Y.info("Created new bartender:",{id:v.id,name:v.full_name}),alert("New bartender created! Note: Bartenders need to be approved by an administrator before appearing on leaderboards."),c(v.full_name),w(!1),f(v)}catch(h){Y.error("Error adding new bartender:",h),N(h.message)}};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:h=>{c(h.target.value),w(!0)},onClick:()=>w(!0),placeholder:l,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),y&&(i.trim()||t||u)&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg",children:[t&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),u&&e.jsx("div",{className:"p-2 text-red-400",children:u}),!t&&!u&&x.length>0&&e.jsxs("div",{children:[x.map(h=>e.jsx("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>m(h),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:h.full_name}),h.is_approved===!1&&e.jsx("span",{className:"text-xs text-yellow-400 px-2 py-1 bg-zinc-800 rounded",children:"Pending"})]})},h.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),i.trim()&&e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:s,children:[e.jsxs("span",{children:['+ Add "',i.trim(),'" as new bartender']}),e.jsx("span",{className:"text-gray-400",children:"→"})]}),!t&&!u&&i.trim()&&x.length===0&&!u&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"No matching bartenders found"})]})]})},q=ee("ClaimForm"),xe=({onSuccess:g,onError:f})=>{const[l,b]=n.useState(null),[d,i]=n.useState(!1),[c,y]=n.useState(null),[w,x]=n.useState(!1),[r,t]=n.useState(null);n.useEffect(()=>{a()},[]);const a=async()=>{try{i(!0);const{data:{user:m}}=await S.auth.getUser();if(!m)return;const{data:s,error:h}=await S.from("submissions").select("id, status, content").eq("user_id",m.id).eq("status","pending").like("content",'%"type":"profile_claim"%').maybeSingle();if(h&&h.code!=="PGRST116")throw h;if(s){q.info("Found existing pending claim",{submissionId:s.id}),y(s);return}const{data:v,error:_}=await S.from("bartenders").select("id, is_profile_claimed").eq("user_id",m.id).single();if(_&&_.code!=="PGRST116")throw _;v!=null&&v.is_profile_claimed&&(q.info("User already has a claimed profile",{bartenderId:v.id}),g==null||g({alreadyClaimed:!0}))}catch(m){q.error("Error checking existing claim:",m),t(m.message),f==null||f(m.message)}finally{i(!1)}},u=async m=>{m.preventDefault(),i(!0),t(null),x(!1);try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("Authentication required");if(!l)throw new Error("Please select a bartender profile");const{data:h,error:v}=await S.from("bartenders").select("is_profile_claimed, users_attempting_to_claim").eq("id",l.id).single();if(v)throw v;if(h!=null&&h.is_profile_claimed)throw new Error("This profile has already been claimed");const _=h.users_attempting_to_claim||[];if(!_.includes(s.id)){const{error:M}=await S.from("bartenders").update({users_attempting_to_claim:[..._,s.id]}).eq("id",l.id);if(M)throw M}const{error:E}=await S.from("submissions").insert({user_id:s.id,content:JSON.stringify({type:"profile_claim",bartender_id:l.id,bartender_name:l.full_name,submitted_at:new Date().toISOString()}),status:"pending"});if(E)throw E;x(!0),q.info("Profile claim submitted successfully",{userId:s.id,bartenderId:l.id}),setTimeout(()=>{g==null||g()},2e3)}catch(s){t(s.message),f==null||f(s.message),q.error("Error submitting profile claim:",s)}finally{i(!1)}},N=async()=>{if(c){i(!0);try{const{data:{user:m}}=await S.auth.getUser();if(!m)throw new Error("Authentication required");let s=null;try{s=JSON.parse(c.content).bartender_id}catch(v){q.error("Error parsing claim content:",v)}if(s){const{data:v}=await S.from("bartenders").select("users_attempting_to_claim").eq("id",s).single();if(v){const _=(v.users_attempting_to_claim||[]).filter(E=>E!==m.id);await S.from("bartenders").update({users_attempting_to_claim:_}).eq("id",s)}}const{error:h}=await S.from("submissions").update({status:"cancelled"}).eq("id",c.id);if(h)throw h;y(null),g==null||g({cancelled:!0}),q.info("Claim cancelled successfully",{submissionId:c.id})}catch(m){t(m.message),f==null||f(m.message),q.error("Error cancelling claim:",m)}finally{i(!1)}}};return c?e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl text-white mb-4",children:"Pending Profile Claim"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Your profile claim is currently under review by an administrator."}),e.jsx("button",{onClick:N,disabled:d,className:"w-full py-2 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":"Cancel Claim"})]}):e.jsxs("form",{onSubmit:u,className:"p-6",method:"POST",children:[e.jsx("h3",{className:"text-xl text-white mb-6",children:"Claim Your Profile"}),r&&e.jsx("div",{className:"error-message mb-4 p-3 bg-red-500/20 border border-red-500 rounded text-red-200",children:r}),w&&e.jsx("div",{className:"success-message mb-4 p-3 bg-green-500/20 border border-green-500 rounded text-green-200",children:"Profile claim submitted successfully! Your claim will be reviewed by an administrator."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white mb-2",children:"Select Your Profile"}),e.jsx(ae,{onSelect:b,placeholder:"Search for your profile",unclaimedOnly:!0})]}),e.jsx("button",{type:"submit",disabled:d||!l||w,className:"w-full py-3 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Submitting...":"Submit Claim"})]})},fe=({onSelect:g,placeholder:f="Search for competition"})=>{const[l,b]=n.useState(""),[d,i]=n.useState(!1),[c,y]=n.useState([]),[w,x]=n.useState(!1),[r,t]=n.useState(null);n.useEffect(()=>{if(!l.trim()){y([]);return}const N=setTimeout(async()=>{x(!0);try{const{data:m,error:s}=await S.from("legacy_competitions").select("id, name, date, venue").ilike("name",`%${l}%`).order("date",{ascending:!1}).limit(5);if(s)throw s;y(m||[])}catch(m){console.error("Error fetching competitions:",m),t("Failed to load competitions")}finally{x(!1)}},300);return()=>clearTimeout(N)},[l]);const a=()=>{g({name:l.trim(),isNew:!0}),b(l.trim()),i(!1)};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l,onChange:u=>{b(u.target.value),i(!0)},onClick:()=>i(!0),placeholder:f,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),d&&l.trim()&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg max-h-60 overflow-y-auto",children:[w&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),r&&e.jsx("div",{className:"p-2 text-red-400",children:r}),!w&&!r&&c.length>0&&e.jsxs("div",{children:[c.map(u=>e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>{g(u),b(u.name),i(!1)},children:[e.jsx("div",{children:u.name}),e.jsxs("div",{className:"text-gray-400 text-sm",children:[new Date(u.date).toLocaleDateString()," - ",u.venue]}),e.jsx("hr",{className:"border-t border-gray-700 mt-2"})]},u.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:a,children:[e.jsxs("span",{children:['+ Add "',l.trim(),'" as new competition']}),e.jsx("span",{className:"text-gray-400",children:"→"})]})]})]})},J=ee("VenueSelect"),be=({value:g,onSelect:f,placeholder:l="Select a venue",initialLabel:b=""})=>{const[d,i]=n.useState(b),[c,y]=n.useState(!1),[w,x]=n.useState([]),[r,t]=n.useState(!1),[a,u]=n.useState(null);n.useEffect(()=>{if(!d.trim()){x([]);return}const h=setTimeout(async()=>{t(!0);try{const{data:v,error:_}=await S.from("venues").select("id, name, city, country").ilike("name",`%${d}%`).is("is_archived",!1).order("name").limit(5);if(_)throw _;x(v||[])}catch(v){J.error("Failed to load venues:",v),u("Failed to load venues")}finally{t(!1)}},300);return()=>clearTimeout(h)},[d]);const N=s=>{i(s.name),y(!1),f(s)},m=async()=>{try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("Please sign in to add a new venue");const{data:h,error:v}=await S.from("venues").insert({name:d.trim(),created_by:s.id}).select().single();if(v)throw v;J.info("Created new venue:",{id:h.id,name:h.name}),i(h.name),y(!1),f(h)}catch(s){J.error("Error adding new venue:",s),u(s.message)}};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:d,onChange:s=>{i(s.target.value),y(!0)},onClick:()=>y(!0),placeholder:l,className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600"}),c&&(d.trim()||r||a)&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-zinc-800 rounded-md border border-gray-700 shadow-lg",children:[r&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"Loading..."}),a&&e.jsx("div",{className:"p-2 text-red-400",children:a}),!r&&!a&&w.length>0&&e.jsxs("div",{children:[w.map(s=>e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white",onClick:()=>N(s),children:[e.jsx("div",{children:s.name}),s.city&&s.country&&e.jsxs("div",{className:"text-gray-400 text-sm",children:[s.city,", ",s.country]})]},s.id)),e.jsx("div",{className:"border-t border-gray-700 mt-2"})]}),d.trim()&&e.jsxs("div",{className:"p-2 hover:bg-zinc-700 cursor-pointer text-white flex justify-between items-center",onClick:m,children:[e.jsxs("span",{children:['+ Add "',d.trim(),'" as new venue']}),e.jsx("span",{className:"text-gray-400",children:"→"})]}),!r&&!a&&d.trim()&&w.length===0&&!a&&e.jsx("div",{className:"p-2 text-gray-300 text-center",children:"No matching venues found"})]})]})},ye=[{id:"state final",label:"State Final"},{id:"national final",label:"National Final"},{id:"global final",label:"Global Final"}],we=({onSuccess:g,onError:f})=>{const[l,b]=n.useState(!1),[d,i]=n.useState(""),[c,y]=n.useState([{id:"",position:""}]),[w,x]=n.useState(!1),[r,t]=n.useState({date:"",venue_id:"",venue_name:"",organizer_id:"",organizer_name:"",source_url:"",category:"legacy",country:"",round:"state final"}),[a,u]=n.useState(null),[N,m]=n.useState(!1),s=()=>{const{organizer_name:o,date:j,round:L,country:C}=r,D=(a==null?void 0:a.name)||"";if(!j||!o||!D||!L)return null;const P=new Date(j).getFullYear();return`${o} ${D} ${P} ${L} ${C||""}`.trim()},h=o=>{u(o),x(!(o!=null&&o.id)),o!=null&&o.id&&t(j=>({...j,date:o.date,venue_id:o.venue_id,venue_name:o.venue,organizer_id:o.organizer,category:o.category||"legacy",country:o.country||""}))},v=async o=>{try{const{data:j}=await S.from("organisers").select("organisation_name").eq("id",o.id).single();t(L=>({...L,organizer_id:o.id,organizer_name:(j==null?void 0:j.organisation_name)||""}))}catch(j){console.error("Error fetching organizer details:",j),i("Error fetching organizer details")}},_=o=>{t(j=>({...j,venue_id:o.id,venue_name:o.name}))},E=o=>({1:25,2:15,3:15,4:12,5:10,6:8,7:6,8:4,9:2,10:1})[o]||0,M=async o=>{o.preventDefault(),b(!0),i(""),m(!1);try{const{data:{user:j},error:L}=await S.auth.getUser();if(L)throw new Error("Authentication error");if(!j)throw new Error("Please sign in to submit results");if(w){if(!r.date)throw new Error("Date is required");if(!r.organizer_id)throw new Error("Organizer is required");if(!r.venue_id)throw new Error("Venue is required");if(!(a!=null&&a.name))throw new Error("Competition name is required");if(!r.round)throw new Error("Competition round is required")}let C;if(a!=null&&a.id)C=a.id;else{const P=s();if(!P)throw new Error("Unable to generate competition name - missing required fields");const{data:O,error:k}=await S.from("legacy_competitions").insert({name:P,date:r.date,venue:r.venue_name,venue_id:r.venue_id,organizer:r.organizer_id,category:r.category,country:r.country||null,created_by:j.id,status:"pending"}).select().single();if(k)throw k;C=O.id}const D=c.filter(P=>P.id&&P.position);if(D.length===0)throw new Error("At least one competitor with position is required");for(const P of D){const{error:O}=await S.from("legacy_results").insert({legacy_competition_id:C,bartender_id:P.id,placement:parseInt(P.position,10),points:E(parseInt(P.position,10)),status:"pending",created_by:j.id,competition_category:r.category});if(O)throw O}if(r.source_url){const{error:P}=await S.from("sources").insert({legacy_competition_id:C,url:r.source_url,created_by:j.id});if(P)throw P}m(!0),setTimeout(()=>{z(),g==null||g()},2e3)}catch(j){console.error("Submission error:",j),i(j.message),f==null||f(j.message)}finally{b(!1)}},z=()=>{t({date:"",venue_id:"",venue_name:"",organizer_id:"",organizer_name:"",source_url:"",category:"legacy",country:"",round:"state final"}),u(null),y([{id:"",position:""}]),x(!1),m(!1)},R=()=>{y(o=>[...o,{id:"",position:""}])},F=o=>{y(j=>j.filter((L,C)=>C!==o))};return e.jsxs("div",{className:"p-6 bg-zinc-800 rounded-lg",children:[e.jsx("h3",{className:"text-xl text-white mb-6",children:"Submit Competition Result"}),d&&e.jsx("div",{className:"error-message mb-4 p-3 bg-red-500/20 border border-red-500 rounded text-red-200",children:d}),N&&e.jsx("div",{className:"success-message mb-4 p-3 bg-green-500/20 border border-green-500 rounded text-green-200",children:"Competition result submitted successfully! Your submission will be reviewed by an administrator."}),e.jsxs("form",{onSubmit:M,className:"space-y-6",method:"POST",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Competition *"}),e.jsx(fe,{onSelect:h,placeholder:"Search or add competition"})]}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Organizer *"}),e.jsx(le,{onSelect:v,placeholder:"Select organizer"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Venue *"}),e.jsx(be,{onSelect:_,placeholder:"Select or add venue"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Round *"}),e.jsx("select",{value:r.round,onChange:o=>t({...r,round:o.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,children:ye.map(o=>e.jsx("option",{value:o.id,children:o.label},o.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Category *"}),e.jsxs("select",{value:r.category,onChange:o=>t({...r,category:o.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,children:[e.jsx("option",{value:"legacy",children:"Legacy Competition"}),e.jsx("option",{value:"speed",children:"Speed"}),e.jsx("option",{value:"flair",children:"Flair"}),e.jsx("option",{value:"traditional",children:"Traditional"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Country"}),e.jsxs("select",{value:r.country,onChange:o=>t({...r,country:o.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",children:[e.jsx("option",{value:"",children:"Select country"}),ce.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Date *"}),e.jsx("input",{type:"date",value:r.date,onChange:o=>t({...r,date:o.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-white mb-2",children:"Source URL *"}),e.jsx("input",{type:"url",value:r.source_url,onChange:o=>t({...r,source_url:o.target.value}),className:"w-full p-2 bg-zinc-700 text-white rounded border border-gray-600",required:!0,placeholder:"Link to competition results"})]}),e.jsxs("div",{className:"competitors-section mt-8",children:[e.jsx("h3",{className:"text-lg text-white mb-4",children:"Competitors *"}),c.map((o,j)=>e.jsxs("div",{className:"competitor-entry mb-4 p-4 bg-zinc-700 rounded",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-2",children:"Competitor Name *"}),e.jsx(ae,{onSelect:L=>{const C=[...c];C[j].id=L.id,y(C)},placeholder:"Search for competitor"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-2",children:"Position *"}),e.jsx("input",{type:"number",value:o.position,onChange:L=>{const C=[...c];C[j].position=L.target.value,y(C)},className:"w-full p-2 bg-zinc-600 text-white rounded border border-gray-500",required:!0,min:"1"})]}),j>0&&e.jsx("button",{type:"button",onClick:()=>F(j),className:"text-red-400 hover:text-red-300 px-4 py-2 border border-red-500 rounded hover:bg-red-500/20 transition-colors",children:"Remove Competitor"})]},j)),e.jsx("button",{type:"button",onClick:R,className:"w-full p-2 border border-gray-400 text-gray-300 rounded hover:bg-zinc-700 transition-colors",children:"Add Competitor"})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full p-3 bg-white text-black font-bold rounded hover:bg-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Submitting...":"Submit Result"})]})]})},U=X("UpcomingCompetitions"),te=()=>{const[g,f]=n.useState([]),[l,b]=n.useState(!0),[d,i]=n.useState(null),{isAuthenticated:c}=re(),[y,w]=n.useState(!1);n.useEffect(()=>{const t=()=>{w(window.innerWidth<=768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),n.useEffect(()=>{(async()=>{b(!0),i(null),U.info("Fetching upcoming competitions data...");try{const a=new Date().toISOString().split("T")[0],{data:u,error:N}=await Z.from("legacy_competitions").select("id, name, date, venue, country, category, status, more_info_link").gte("date",a).order("date",{ascending:!0}).limit(3);if(N)throw U.error("Error fetching upcoming competitions:",N),new Error(`Failed to fetch upcoming competitions: ${N.message}`);f(u||[]),U.debug(`Fetched ${(u==null?void 0:u.length)||0} upcoming competitions.`)}catch(a){U.error("Error in fetchCompetitions:",a),i(a.message)}finally{b(!1)}})()},[]);const x=t=>{let a="category-badge",u=t||"Legacy";switch(t==null?void 0:t.toLowerCase()){case"speed":a+=" bg-red-500 text-white",u="Speed";break;case"flair":a+=" bg-green-500 text-black",u="Flair";break;case"traditional":a+=" bg-blue-500 text-white",u="Traditional";break;default:a+=" bg-zinc-500 text-white";break}return e.jsx("span",{className:`${a} inline-block px-2 py-1 rounded text-xs font-medium`,children:u})},r=t=>e.jsxs("div",{className:"bg-zinc-800 p-4 rounded-lg shadow-md h-full flex flex-col",children:[e.jsx("div",{className:"event-date text-sm text-gray-400 mb-1",children:new Date(t.date).toLocaleDateString()}),e.jsx("h3",{className:"event-name text-white font-medium text-lg mb-2",children:t.name}),e.jsx("div",{className:"event-category mb-2",children:x(t.category)}),e.jsx("div",{className:"event-venue text-gray-300 mb-4",children:t.venue}),e.jsx("div",{className:"mt-auto pt-4 border-t border-zinc-700",children:e.jsx("a",{href:"https://airtable.com/appMQggH3bB7G8pRV/pagGsPtPvflViR9PC/form",target:"_blank",rel:"noopener noreferrer",className:`block w-full py-2 text-center rounded ${c?"bg-white text-black hover:bg-zinc-200":"bg-zinc-600 text-gray-300 cursor-not-allowed"}`,onClick:a=>!c&&a.preventDefault(),title:c?"Register for event":"Sign in to register",children:c?"Register":"Sign in to Register"})})]});return g.length===0&&!l?null:l?e.jsxs("div",{className:"upcoming-competitions mt-8 mb-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Upcoming Events"}),e.jsx("div",{className:"animate-pulse flex space-x-4",children:e.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[e.jsx("div",{className:"h-12 bg-zinc-700 rounded"}),e.jsx("div",{className:"h-12 bg-zinc-700 rounded"})]})})]}):d?e.jsxs("div",{className:"upcoming-competitions mt-8 mb-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Upcoming Events"}),e.jsx("div",{className:"bg-red-900/20 border border-red-500 text-red-200 p-4 rounded-lg",children:"Error loading upcoming events."})]}):e.jsxs("div",{className:"upcoming-competitions mt-8 mb-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Upcoming Events"}),y&&e.jsx("div",{className:"md:hidden",children:e.jsx(de,{events:g,renderEventCard:r,emptyMessage:"No upcoming events scheduled yet."})}),!y&&e.jsx("div",{className:"hidden md:block bg-zinc-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-zinc-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Register"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-750",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:x(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:t.venue}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("a",{href:"https://airtable.com/appMQggH3bB7G8pRV/pagGsPtPvflViR9PC/form",target:"_blank",rel:"noopener noreferrer",className:`px-3 py-1 rounded ${c?"bg-white text-black hover:bg-zinc-200":"bg-zinc-600 text-gray-300 cursor-not-allowed"}`,onClick:a=>!c&&a.preventDefault(),title:c?"Register for event":"Sign in to register",children:c?"Register":"Sign in to Register"})})]},t.id))})]})})]})},T=X("HomePage"),_e=()=>{var k;const[g,f]=n.useState({legacy:[],traditional:[],flair:[],speed:[]}),[l,b]=n.useState(!0),[d,i]=n.useState(null),[c,y]=n.useState("Loading Leaderboards..."),[w,x]=n.useState(null),{user:r,isAuthenticated:t,profile:a,loading:u}=re(),[N,m]=n.useState(!1),[s,h]=n.useState({legacy:{page:0,filter:"rating"},speed:{page:0,filter:"rating"},traditional:{page:0,filter:"rating"},flair:{page:0,filter:"rating"}}),[v,_]=n.useState(!1),[E,M]=n.useState(!1),z=ie(),R=ne(),F=(k=z.state)==null?void 0:k.scrollTo;n.useEffect(()=>{(async()=>{if(!t||!r){m(!1);return}try{const{data:$,error:B}=await Z.from("submissions").select("id, status").eq("user_id",r.id).eq("status","pending").contains("content",{type:"profile_claim"}).maybeSingle();if(B)throw B;m(!!$),T.debug("Pending claim check result:",{hasPendingClaim:!!$})}catch($){T.error("Error checking pending claims:",$)}})()},[t,r]);const o=n.useCallback(async()=>{b(!0),i(null),T.info("Fetching leaderboard data...");try{const p=await ue.fetchLeaderboardData();f({legacy:(p==null?void 0:p.legacy)||[],traditional:(p==null?void 0:p.traditional)||[],flair:(p==null?void 0:p.flair)||[],speed:(p==null?void 0:p.speed)||[]}),T.info("Leaderboard data fetched successfully")}catch(p){T.error("Error fetching leaderboard data:",p),p.message.includes("timeout")?i("Loading took longer than expected. The system is experiencing delays. Please try refreshing the page or contact support if this persists."):p.message.includes("session")?i("Authentication issue detected. Please try signing out and back in."):p.message.includes("network")||p.message.includes("fetch")?i("Network connectivity issue. Please check your internet connection and try again."):i("Failed to load leaderboard data. Please try refreshing the page or contact support if this issue persists."),f({legacy:[],traditional:[],flair:[],speed:[]}),T.error("Fetch error context:",{errorType:p.name,errorMessage:p.message,stack:p.stack,timestamp:new Date().toISOString()})}finally{b(!1)}},[]);n.useEffect(()=>{if(u){T.debug("Waiting for auth state to be ready before fetching data");return}T.debug("Auth state ready, proceeding with data fetch",{isAuthenticated:t,authLoading:u}),o()},[o,u,t]),n.useEffect(()=>{if(!l)return;y("Loading Leaderboards..."),x(null);const p=setTimeout(()=>{l&&(y("Loading Leaderboards... this is taking a while, give it"),x(15))},1e4);return()=>clearTimeout(p)},[l]),n.useEffect(()=>{if(w===null||!l)return;if(w===0){R("/error",{state:{message:"Loading took too long (25+ seconds). This may indicate a connectivity issue.",contact:"cocktails+mbc@trapadl.com"}});return}const p=setTimeout(()=>{x($=>$-1)},1e3);return()=>clearTimeout(p)},[w,R,l]),n.useEffect(()=>{if(F){T.debug(`Scrolling to section: ${F}`);const p=document.getElementById(`${F}-section`),$=document.querySelector(".column-right");if(p&&$){const B=p.offsetTop,A=parseFloat(getComputedStyle($).paddingTop||"0"),I=B-A;T.debug(`Target offsetTop: ${B}, Container padding: ${A}, Effective scroll: ${I}`);const G=setTimeout(()=>{$.scrollTo({top:I,behavior:"smooth"}),R(z.pathname,{replace:!0,state:{...z.state,scrollTo:null}})},150);return()=>clearTimeout(G)}else T.warn(`Scroll target #${F}-section or .column-right not found`),R(z.pathname,{replace:!0,state:{...z.state,scrollTo:null}})}},[F,z.pathname,z.state,R]);const j=(p,$)=>{h(I=>({...I,[p]:{...I[p],page:$}}));const B=document.getElementById(`${p}-section`),A=document.querySelector(".column-right");if(B&&A){const I=B.offsetTop,G=parseFloat(getComputedStyle(A).paddingTop||"0"),se=I-G;A.scrollTo({top:se,behavior:"smooth"})}},L=(p,$)=>{h(B=>({...B,[p]:{...B[p],filter:$,page:0}}))},C=()=>{if(!t){V("Please sign in or create an account to claim a profile."),R("/enter",{state:{from:z}});return}_(!0),T.info("Claim Profile modal opened")},D=()=>{if(!t){V("Please sign in or create an account to submit results."),R("/enter",{state:{from:z}});return}M(!0),T.info("Submit Result modal opened")},O=!(t&&(a==null?void 0:a.is_profile_claimed)===!0)&&!N;return l||u?e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen col-span-2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-white rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-4 text-gray-300",children:c})]}),w!==null&&e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"text-yellow-400 font-bold text-lg",children:["[",w,"]"]}),e.jsx("span",{className:"text-gray-300 ml-2",children:"more seconds before calling it an issue"})]})]}):d?e.jsx("div",{className:"text-center p-10 text-red-400 col-span-2",children:d}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"column-left hidden md:flex",children:[" ",e.jsxs("div",{className:"column-left-content text-white p-8",children:[" ",e.jsx("div",{style:{height:"calc(100vh * 4 / 13)",minHeight:"200px",flexShrink:0}}),t&&a?e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Welcome, ",a.full_name||"Competitor","!"]}):e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"PROFESSIONAL BARTENDING. A NEW GLOBAL SPORT."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"Our goal is to transform one of the worlds oldest professions into a thrilling, worldwide competition by uniting bartenders, bars, and brands under one transparent ranking system."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"These leaderboards rank bartenders with registered competition results. Legacy competitions are events held by brand organisers - the ones most bartenders are familiar with. MBC Speed, Traditional and Flair and MBC sanctioned events that adhere to guidelines of fairness, transparency and integrity."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To add yourself to the leaderboard, click 'submit result'."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To find out more about our pillars and goals, click the about section of our site menu."}),e.jsx(te,{}),e.jsxs("p",{className:"text-gray-400 text-sm mt-8",children:["This service is created and maintained by passionate bartenders out of ",e.jsx("a",{href:"http://www.trapadl.com",className:"text-white hover:text-gray-300",target:"_blank",rel:"noopener noreferrer",children:"trap. cocktail bar"})," in Adelaide, Australia. It's constantly undergoing improvements. Feedback, bug reports, or contribution inquiries are welcome via ",e.jsx("a",{href:"mailto:cocktails+mbc@trapadl.com",className:"text-white hover:text-gray-300",children:"cocktails+mbc@trapadl.com"}),"."]})]})]}),e.jsxs("div",{className:"block md:hidden p-4 text-white",children:[e.jsx("div",{style:{minHeight:"200px",flexShrink:0}}),t&&a?e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Welcome, ",a.full_name||"Competitor","!"]}):e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"PROFESSIONAL BARTENDING. A NEW GLOBAL SPORT."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"Our goal is to transform one of the worlds oldest professions into a thrilling, worldwide competition by uniting bartenders, bars, and brands under one transparent ranking system."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"These leaderboards rank bartenders with registered competition results. Legacy competitions are events held by brand organisers - the ones most bartenders are familiar with. MBC Speed, Traditional and Flair and MBC sanctioned events that adhere to guidelines of fairness, transparency and integrity."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To add yourself to the leaderboard, click 'submit result'."}),e.jsx("p",{className:"mb-4 text-gray-300",children:"To find out more about our pillars and goals, click the about section of our site menu."}),e.jsx(te,{}),e.jsxs("p",{className:"text-gray-400 text-sm mt-8",children:["This service is created and maintained by passionate bartenders out of ",e.jsx("a",{href:"http://www.trapadl.com",className:"text-white hover:text-gray-300",target:"_blank",rel:"noopener noreferrer",children:"trap. cocktail bar"})," in Adelaide, Australia. It's constantly undergoing improvements. Feedback, bug reports, or contribution inquiries are welcome via ",e.jsx("a",{href:"mailto:cocktails+mbc@trapadl.com",className:"text-white hover:text-gray-300",children:"cocktails+mbc@trapadl.com"}),"."]})]}),e.jsxs("div",{className:"column-right w-full md:w-1/2",children:[" ",e.jsxs("div",{className:"column-right-content space-y-12 p-4 md:p-8 ",children:[" ",e.jsx(H,{id:"legacy-section",title:"Legacy Leaderboard",type:"legacy",data:g.legacy,page:s.legacy.page,filter:s.legacy.filter,onPageChange:j,onFilterChange:L,showFilters:!1,showClaimButton:O,hasPendingClaim:N,onClaimProfileClick:C,onSubmitResultClick:D}),e.jsx(H,{id:"speed-section",title:"MBC Speed Leaderboard",type:"speed",data:g.speed,page:s.speed.page,filter:s.speed.filter,onPageChange:j,onFilterChange:L}),e.jsx(H,{id:"traditional-section",title:"MBC Traditional Leaderboard",type:"traditional",data:g.traditional,page:s.traditional.page,filter:s.traditional.filter,onPageChange:j,onFilterChange:L,comingSoon:!0}),e.jsx(H,{id:"flair-section",title:"MBC Flair Leaderboard",type:"flair",data:g.flair,page:s.flair.page,filter:s.flair.filter,onPageChange:j,onFilterChange:L,comingSoon:!0})]})]}),e.jsx(K,{isOpen:v,onClose:()=>_(!1),title:"Claim Your Profile",children:e.jsx(xe,{onSuccess:()=>{T.info("Claim success callback triggered."),_(!1),m(!0),o()},onError:p=>T.error("Claim form error:",p)})}),e.jsx(K,{isOpen:E,onClose:()=>M(!1),title:"Submit Competition Result",maxWidth:"max-w-2xl",children:e.jsx(we,{onSuccess:()=>{T.info("Result success callback triggered."),M(!1),V("Result submitted for admin review!")},onError:p=>T.error("Result form error:",p)})}),e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 md:hidden z-50",children:e.jsx("button",{onClick:()=>{const p=document.querySelector(".column-right");p&&p.scrollIntoView({behavior:"smooth"})},className:"bg-black text-white px-6 py-3 rounded-full shadow-lg hover:bg-zinc-800 transition",children:"↓ Leaderboards ↓"})})]})};export{_e as default};
