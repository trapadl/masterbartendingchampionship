import{r as c,u as P,j as e,R as F,a as v,b as I}from"./main-BvTxE4Sc.js";import{E as w}from"./EventCarousel-zC09k1kg.js";const o=I("SchedulePage"),U=()=>{const[u,_]=c.useState([]),[f,C]=c.useState([]),[k,y]=c.useState(!0),[b,j]=c.useState(null),[m,E]=c.useState(null),{isAuthenticated:d}=P(),[h,R]=c.useState(!1);c.useEffect(()=>{const t=()=>{R(window.innerWidth<=768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),c.useEffect(()=>{(async()=>{y(!0),j(null),o.info("Fetching competition schedule data...");try{const s=new Date().toISOString().split("T")[0],{data:a,error:l}=await v.from("legacy_competitions").select("id, name, date, venue, category, status, more_info_link").gte("date",s).order("date",{ascending:!0});if(l)throw o.error("Error fetching upcoming competitions:",l),new Error(`Failed to fetch upcoming competitions: ${l.message}`);_(a||[]),o.debug(`Fetched ${(a==null?void 0:a.length)||0} upcoming competitions.`);const{data:n,error:r}=await v.from("legacy_competitions").select(`
            id, name, date, venue, category, status,
            legacy_results (
              placement,
              post_competition_rating,
              pre_competition_rating,
              bartender:bartenders ( full_name )
            )
          `).eq("status","approved").lt("date",s).order("date",{ascending:!1});if(r)throw o.error("Error fetching past competitions:",r),new Error(`Failed to fetch past competitions: ${r.message}`);C(n||[]),o.debug(`Fetched ${(n==null?void 0:n.length)||0} past competitions.`)}catch(s){o.error("Error in fetchCompetitions:",s),j(s.message)}finally{y(!1),o.info("Finished fetching competition schedule data.")}})()},[]);const S=t=>{E(m===t?null:t)},p=t=>{let s="category-badge",a=t||"Legacy";switch(t==null?void 0:t.toLowerCase()){case"speed":s+=" category-speed bg-red-500 text-white",a="Speed";break;case"flair":s+=" category-flair bg-green-500 text-black",a="Flair";break;case"traditional":case"legacy":s+=" category-traditional bg-blue-500 text-white",a="Traditional";break;default:s+=" bg-zinc-500 text-white";break}return e.jsx("span",{className:`${s} inline-block px-2 py-1 rounded text-xs font-medium`,children:a})},z=t=>e.jsxs("div",{className:"bg-zinc-800 p-4 rounded-lg shadow-md h-full flex flex-col",children:[e.jsx("div",{className:"event-date text-sm text-gray-400 mb-1",children:new Date(t.date).toLocaleDateString()}),e.jsx("h3",{className:"event-name text-white font-medium text-lg mb-2",children:t.name}),e.jsx("div",{className:"event-category mb-2",children:p(t.category)}),e.jsx("div",{className:"event-venue text-gray-300 mb-2",children:t.venue}),t.more_info_link&&e.jsx("a",{href:t.more_info_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 mb-4 inline-block",children:"More Info →"}),e.jsx("div",{className:"mt-auto pt-4 border-t border-zinc-700",children:e.jsx("a",{href:"https://airtable.com/appMQggH3bB7G8pRV/pagGsPtPvflViR9PC/form",target:"_blank",rel:"noopener noreferrer",className:`block w-full py-2 text-center rounded ${d?"bg-white text-black hover:bg-zinc-200":"bg-zinc-600 text-gray-300 cursor-not-allowed"}`,onClick:s=>!d&&s.preventDefault(),children:d?"Register":"Sign In to Register"})})]}),D=t=>{var l;const s=((l=t.legacy_results)==null?void 0:l.sort((n,r)=>n.placement-r.placement))||[],a=s.slice(0,3);return e.jsxs("div",{className:"bg-zinc-800 p-4 rounded-lg shadow-md h-full flex flex-col",children:[e.jsx("div",{className:"event-date text-sm text-gray-400 mb-1",children:new Date(t.date).toLocaleDateString()}),e.jsx("h3",{className:"event-name text-white font-medium text-lg mb-2",children:t.name}),e.jsx("div",{className:"event-category mb-2",children:p(t.category)}),e.jsx("div",{className:"event-venue text-gray-300 mb-4",children:t.venue}),a.length>0?e.jsxs("div",{className:"mt-2 border-t border-zinc-700 pt-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Top Results:"}),e.jsx("ul",{className:"space-y-2",children:a.map((n,r)=>{var N;const x=n.post_competition_rating??"?",g=n.pre_competition_rating??x,i=x!=="?"&&g!=="?"?Math.round(x-g):"?",L=i!=="?"&&i>=0?"+":"",M=i!=="?"?i>0?"text-green-400":i<0?"text-red-400":"text-gray-400":"text-gray-400";return e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-white",children:[n.placement,". ",((N=n.bartender)==null?void 0:N.full_name)||"Unknown"]}),e.jsxs("span",{className:M,children:[L,i]})]},r)})}),s.length>3&&e.jsxs("div",{className:"text-center mt-2 text-xs text-gray-400",children:["+",s.length-3," more competitors"]})]}):e.jsx("div",{className:"text-gray-400 italic mt-auto",children:"No results available"})]})};return k?e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"}),e.jsx("span",{className:"ml-4 text-gray-300",children:"Loading Schedule..."})]}):b?e.jsxs("div",{className:"text-center p-10 text-red-400",children:["Error loading schedule: ",b]}):e.jsxs("div",{className:"content-section max-w-6xl mx-auto px-4 sm:px-8 py-8 text-white",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Competition Schedule"}),e.jsxs("div",{className:"schedule-section mt-4",children:[e.jsx("h2",{className:"text-xl font-semibold p-4 border-b border-gray-700",children:"Upcoming Events"}),h&&e.jsx("div",{className:"md:hidden mt-4",children:e.jsx(w,{events:u,renderEventCard:z,emptyMessage:"No upcoming events scheduled yet."})}),!h&&e.jsx("div",{className:"hidden md:block bg-zinc-800 rounded-lg overflow-hidden",children:u.length>0?e.jsxs("table",{className:"schedule-table min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-700",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Info"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Register"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:u.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-750",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:p(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.venue}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.more_info_link?e.jsx("a",{href:t.more_info_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 hover:underline",children:"See More"}):"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("a",{href:"https://airtable.com/appMQggH3bB7G8pRV/pagGsPtPvflViR9PC/form",target:"_blank",rel:"noopener noreferrer",className:`px-3 py-1 rounded ${d?"bg-white text-black hover:bg-zinc-200":"bg-zinc-600 text-gray-300 cursor-not-allowed"}`,onClick:s=>!d&&s.preventDefault(),title:d?"Register for event":"Sign in to register",children:d?"Register":"Sign In"})})]},t.id))})]}):e.jsx("p",{className:"p-4 text-gray-400",children:"No upcoming events scheduled yet."})})]}),e.jsx("h2",{className:"text-2xl font-bold mt-12 mb-6",children:"Past Competitions"}),h&&e.jsx("div",{className:"md:hidden mt-4",children:e.jsx(w,{events:f,renderEventCard:D,emptyMessage:"No past competition data found."})}),!h&&e.jsx("div",{className:"hidden md:block bg-zinc-800 rounded-lg overflow-hidden",children:f.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"schedule-table min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-700",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Results"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:f.map(t=>e.jsxs(F.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-zinc-750",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:p(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.venue}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>S(t.id),className:"text-blue-400 hover:text-blue-300 text-xl","aria-expanded":m===t.id,children:m===t.id?"▲":"▼"})})]}),m===t.id&&e.jsx("tr",{className:"bg-zinc-750",children:e.jsx("td",{colSpan:"5",className:"p-0",children:e.jsx("div",{className:"p-4",children:t.legacy_results&&t.legacy_results.length>0?e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Placement"}),e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Bartender"}),e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Rating After"}),e.jsx("th",{className:"py-2 px-3 text-left font-normal",children:"Change"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-600",children:t.legacy_results.sort((s,a)=>s.placement-a.placement).map((s,a)=>{var i;const l=s.post_competition_rating??"?",n=s.pre_competition_rating??l,r=l!=="?"&&n!=="?"?Math.round(l-n):"?",x=r!=="?"&&r>=0?"+":"",g=r!=="?"?r>0?"text-green-400":r<0?"text-red-400":"text-gray-400":"text-gray-400";return e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-3",children:s.placement}),e.jsx("td",{className:"py-2 px-3",children:((i=s.bartender)==null?void 0:i.full_name)||"Unknown"}),e.jsx("td",{className:"py-2 px-3",children:l!=="?"?Math.round(l):"?"}),e.jsxs("td",{className:`py-2 px-3 ${g}`,children:[x,r]})]},a)})})]}):e.jsx("p",{className:"text-gray-400 italic",children:"No results available for this competition."})})})})]},t.id))})]})}):e.jsx("p",{className:"p-4 text-gray-400",children:"No past competition data found."})})]})};export{U as default};
